# npm 包管理了解多少？【热度: 1,321】

- Issue: #316
- State: open
- Labels: 工程化, 腾讯
- Author: yanlele
- URL: https://github.com/pro-collection/interview-question/issues/316
- Created: 2023-04-26T15:28:50Z
- Updated: 2023-04-26T15:28:50Z

## Body

**关键词**：npm 依赖管理、npm 包管理、npm 缓存

**npm 是如何进行依赖管理的？**

npm 是通过 package.json 文件来进行依赖管理的。当在项目中使用第三方库时，我们可以在 package.json 中添加对应的依赖项及版本号，npm 会根据 package.json 中的依赖关系，自动安装相应的依赖包及其依赖项。当我们执行 npm install 命令时，npm 会自动根据 package.json 中的依赖信息进行依赖包的安装。

npm 的依赖管理还涉及到依赖的版本控制，可以在 package.json 中指定对应的版本号，常见的版本号控制符号有：

- `^（caret）`：匹配到次要版本号（第二个数字）的最新版本。例如，^1.2.3 表示安装 1.2.x 的最新版本（除了 1.3.0）。
- `~（tilde）`：匹配到修订版本号（第三个数字）的最新版本。例如，~1.2.3 表示安装 1.2.3 到 1.2.x 的最新版本（除了 1.3.0）。
- `*`：匹配到最新的版本。
- `>=`：匹配到大于或等于指定版本的最新版本。
- `<、<=、>`：匹配到小于、小于等于或大于指定版本的最新版本。

在 npm 的依赖管理中，还有两种类型的依赖关系：生产依赖和开发依赖。生产依赖是指在应用程序运行时必须要加载的依赖，开发依赖是指在应用程序开发过程中使用的依赖。在 package.json 中，生产依赖使用 dependencies 字段，开发依赖使用 devDependencies 字段。这样可以让项目更加清晰地管理其依赖关系。


**npm 有缓存包的能力吗？**

npm有缓存包的能力。当你第一次使用npm安装一个包时，npm会自动将该包缓存在本地。这样，当你下次需要安装相同版本的该包时，npm就不必重新从网络上下载该包，而是直接使用缓存中的包。这样可以提高包的下载速度，节省网络带宽。

npm的缓存位于本地文件系统中的一个隐藏目录。默认情况下，缓存位于当前用户的主目录下的.npm目录中。你可以使用以下命令查看npm缓存的路径：
```shell
npm config get cache
```

你也可以通过npm cache命令来管理npm缓存，例如清空缓存：
```shell
npm cache clean
```

或者查看缓存的统计信息：
```shell
npm cache ls
```


**npm 是如何使用缓存中的包的？**

使用缓存中的包可以通过以下两种方式实现：

- `使用 npm ci 命令`
npm ci 命令会首先检查 package-lock.json 或 npm-shrinkwrap.json 文件，以确保安装的依赖与锁定的版本一致。然后，它会在 node_modules 目录下安装依赖，如果缓存中存在符合要求的包，npm ci 会直接从缓存中复制到 node_modules 目录下，而不需要重新下载和编译。

- `手动指定缓存路径`
如果需要手动使用缓存中的包，可以在 npm install 命令中指定缓存路径，例如：
```shell
npm install --cache /path/to/npm-cache
```
然后，执行 npm install 命令时，npm 会尝试从指定的缓存路径中获取包，如果找到匹配的包，就会直接复制到 node_modules 目录下。

需要注意的是，手动指定缓存路径的方式可能会导致不同的项目之间共用缓存，因此需要确保缓存路径的唯一性。

