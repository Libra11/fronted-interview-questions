# cookie 可以实现不同域共享吗【热度: 533】

- Issue: #796
- State: open
- Labels: 网络, TOP100互联网
- Author: yanlele
- URL: https://github.com/pro-collection/interview-question/issues/796
- Created: 2024-07-12T13:34:16Z
- Updated: 2025-02-09T15:10:07Z

## Body

**关键词**：cookie 共享

通常，Cookie不能直接在不同域间共享，这源于浏览器同源策略，该策略由协议、域名和端口号共同界定“源”，只有三者完全相同才属同源，Cookie才能在其间共享。但在特定条件和技术手段下，可实现不同域间一定程度的Cookie共享，同时，Cookie也能设置为在同主域下的子域间共享，具体如下：

### 不同域共享Cookie
- **跨域资源共享（CORS）**：在服务端设置`Access-Control-Allow-Origin`等CORS头信息，允许特定跨域请求。但主要用于解决跨域资源请求，对Cookie共享支持有限，一般仅能共享简单、非敏感的Cookie信息，且需客户端与服务端配合。
- **设置P3P头**：P3P用于网站向用户传达隐私策略，通过在响应头设置相关信息，理论上可让浏览器允许跨域设置Cookie。不过，该方法存在兼容性问题，在现代浏览器中支持程度不一，且有安全风险。
- **JSONP**：利用`<script>`标签跨域特性实现跨域数据获取，可间接模拟Cookie部分功能，但并非真正的Cookie共享。
- **跨域Cookie共享技术方案**：如单点登录（SSO）系统采用OAuth、OpenID Connect等协议实现跨域身份验证与授权，在此过程中实现用户信息与相关Cookie的共享。但这需要多个域间统一配置管理，且有专门认证服务器协调。

### 同主域下子域共享Cookie
- **实现原理**：设置Cookie的`Domain`属性，若将其设为主域，该Cookie在主域及其所有子域都可用。例如，主域`example.com`，将Cookie的`Domain`设为`.example.com`，则在`sub1.example.com`、`sub2.example.com`等子域都能访问使用此Cookie。
- **实现方法**：
    - **服务端设置**：使用各种服务器端编程语言，通过HTTP响应头设置实现。如Java中利用`HttpServletResponse`对象设置Cookie的`Domain`属性。
    - **客户端设置**：浏览器端可用JavaScript设置Cookie，使其在同主域下子域共享，但受浏览器同源策略与安全限制。
- **注意事项**：
    - **安全性考量**：虽方便子域交互，但存在安全风险，任一子域遭攻击，攻击者可能利用Cookie访问其他子域资源。因此，设置Cookie共享时，要保证各子域安全，避免在Cookie存储敏感信息。
    - **浏览器兼容性**：多数现代浏览器支持通过设置`Domain`属性实现子域共享Cookie，但旧版本浏览器或特殊配置环境可能存在兼容性问题，实际应用需充分测试。 
