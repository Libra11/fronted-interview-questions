# 前端如何实现截图？

- Issue: #188
- State: open
- Labels: web应用场景
- Author: yanlele
- URL: https://github.com/pro-collection/interview-question/issues/188
- Created: 2023-03-26T09:34:41Z
- Updated: 2025-03-05T03:53:42Z

## Body

前端实现截图需要使用 HTML5 的 Canvas 和相关 API，具体步骤如下：

1. 首先在页面中创建一个 Canvas 元素，并设置其宽高和样式。
2. 使用 Canvas API 在 Canvas 上绘制需要截图的内容，比如页面的某个区域、某个元素、图片等。
3. 调用 Canvas API 中的 `toDataURL()` 方法将 Canvas 转化为 base64 编码的图片数据。
4. 将 base64 编码的图片数据传递给后端进行处理或者直接在前端进行显示。

以下是一个简单的例子，实现了对整个页面的截图：

```html
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>截图示例</title>
    <style>
      #canvas {
        position: fixed;
        left: 0;
        top: 0;
        z-index: 9999;
      }
    </style>
  </head>
  <body>
    <h1>截图示例</h1>
    <p>这是一个简单的截图示例。</p>
    <button id="btn">截图</button>
    <canvas id="canvas"></canvas>
    <script>
      const canvas = document.getElementById('canvas');
      const ctx = canvas.getContext('2d');
      const btn = document.getElementById('btn');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      btn.addEventListener('click', () => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(document.documentElement, 0, 0);
        const imgData = canvas.toDataURL();
        console.log(imgData);
      });
    </script>
  </body>
</html>
```

这个例子中，在页面中创建了一个 `canvas` 元素，并设置其宽高和样式，将其放在页面最上方。在点击“截图”按钮时，通过 `toDataURL()` 方法将整个页面的截图转换为 base64 编码的图片数据，并打印到控制台上。

## Comments / Answers

---

**Guan-Erjia** at 2023-09-12T03:20:43Z

drawImage不支持传入htmlElement

Uncaught TypeError: Failed to execute 'drawImage' on 'CanvasRenderingContext2D': The provided value is not of type '(CSSImageValue or HTMLCanvasElement or HTMLImageElement or HTMLVideoElement or ImageBitmap or OffscreenCanvas or SVGImageElement or VideoFrame)'.

---

**BruceYuj** at 2025-03-04T12:44:30Z

想要将 DOM 元素截图，两种方案：
1. 直接通过 canvas 模拟 DOM 元素的外观属性，比如 **文本：用 fillText 渲染文本，复制字体样式（如 font-family、font-size**。类似于 html2canvas 库。
2. 先转成 svg, 再用 canvas 绘制。类似于 dom-to-image库

---

**canvascat** at 2025-03-05T03:53:41Z

可以借助 getDisplayMedia 捕获窗口内容，然后通过 canvas 对捕获到的内容进行处理
https://github.com/canvascat/electron-screenshot/blob/aa6d90dcaeb3f648625f588c55486973d6398afc/src/util/util.ts#L28-L47
```ts
   const stream = await navigator.mediaDevices.getDisplayMedia(); 
   const video = await new Promise( 
     (resolve: (video: HTMLVideoElement) => void, reject) => { 
       const video = document.createElement('video'); 
       video.setAttribute('autoplay', 'true'); 
       sleep(1000).then(reject); 
       video.onplay = () => resolve(video); 
       video.srcObject = stream; 
     } 
   ); 
   const { videoHeight: height, videoWidth: width } = video; 
   const canvas = document.createElement('canvas'); 
   Object.assign(canvas, { height, width }); 
   canvas.getContext('2d')?.drawImage(video, 0, 0); 
   const tracks = (video.srcObject as MediaStream).getTracks(); 
   tracks.forEach((track) => track.stop()); 
   video.srcObject = null;

   // 处理 canvas
```

