# 原生 js 如何进行监听路由的变化【热度: 906】

- Issue: #495
- State: open
- Labels: 浏览器, 网易
- Author: yanlele
- URL: https://github.com/pro-collection/interview-question/issues/495
- Created: 2023-07-26T15:48:43Z
- Updated: 2023-09-05T07:30:20Z

## Body

**关键词**：原生路由监听

在原生 JavaScript 中，可以使用 window 对象上的 popstate 事件来监听路由的变化。popstate 事件在浏览器的历史记录发生变化时触发，包括当用户点击浏览器的前进或后退按钮、调用 history.pushState() 或 history.replaceState() 方法等。

下面是一个简单的示例代码，演示如何使用 popstate 事件监听路由的变化：

```javascript
// 监听 popstate 事件
window.addEventListener('popstate', function(event) {
  // 在这里可以执行路由变化后的处理逻辑
  console.log('路由发生了变化');
});

// 修改 URL 并添加一条历史记录
history.pushState(null, null, '/new-route');

// 或者使用 history.replaceState() 方法替换当前历史记录
// history.replaceState(null, null, '/new-route');
```

在上面的代码中，当 popstate 事件触发时，回调函数会被执行。你可以在回调函数中添加适当的处理逻辑，例如更新页面内容、重新渲染视图等。

需要注意的是，popstate 事件不会在页面加载时触发，因此如果你需要在页面加载时执行一些初始化的路由处理逻辑，可以将该逻辑封装为一个函数，并在加载时调用一次，然后再通过 popstate 事件监听路由的变化。

另外，还可以使用 history.state 属性来获取当前历史记录的状态对象，该对象可以在调用 history.pushState() 或 history.replaceState() 方法时传入。这样可以在 popstate 事件回调函数中访问和使用该状态对象。

```javascript
window.addEventListener('popstate', function(event) {
  var state = history.state;
  // 在这里可以访问和使用历史记录的状态对象
});
```

通过监听 popstate 事件，可以在原生 JavaScript 中轻松地监听和响应路由的变化，从而实现相应的页面切换和处理逻辑。


## Comments / Answers

---

**Ctrl30** at 2023-08-17T08:20:56Z

我试了这个监听没效果。。。 是我浏览器有问题？

---

**yanlele** at 2023-08-17T08:27:44Z

> 我试了这个监听没效果。。。 是我浏览器有问题？

@Ctrl30 

这个是处理原生事件的哟。 

可以看这个文档：https://developer.mozilla.org/zh-CN/docs/Web/API/Window/popstate_event

---

**wuhuaizai** at 2023-09-05T07:15:27Z

调用 history.pushState() 或 history.replaceState() 方法不会触发popstate事件

---

**yanlele** at 2023-09-05T07:30:20Z

> 调用 history.pushState() 或 history.replaceState() 方法不会触发popstate事件

@wuhuaizai 

可以试试下面这段代码

```js
window.onpopstate = function (event) {
  alert(
    "location: " +
      document.location +
      ", state: " +
      JSON.stringify(event.state),
  );
};

history.pushState({ page: 1 }, "title 1", "?page=1"); // 页面前进一个状态
history.pushState({ page: 2 }, "title 2", "?page=2"); // // 页面前进2个状态
history.replaceState({ page: 3 }, "title 3", "?page=3"); // // 页面前进3个状态
history.back(); // 弹出 "location: http://example.com/example.html?page=1, state: {"page":1}" // 回退状态
history.back(); // 弹出 "location: http://example.com/example.html, state: null 
history.go(2); // 弹出 "location: http://example.com/example.html?page=3, state: {"page":3}
```

可以之所以没有触发，可以参考这个：
![image](https://github.com/pro-collection/interview-question/assets/22188674/f687f76d-fbf9-4aad-b1e4-037899af462c)

