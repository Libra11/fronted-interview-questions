<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>react å¼€å‘çš„åº”ç”¨é‡Œé¢ï¼Œ å¦‚ä½•ç»™ç³»ç»Ÿè®¾ç½®ä¸€ä¸ªå…¨å±€çš„å´©æºƒçš„æç¤ºé¡µé¢ã€çƒ­åº¦: 725ã€‘ - é¢è¯•é¢˜åˆ·é¢˜</title>
  <link rel="stylesheet" href="../assets/styles.css" />
  <meta name="description" content="&lt;p&gt;&lt;strong&gt;å…³é”®è¯&lt;/strong&gt;ï¼šå´©æºƒæç¤º&lt;/p&gt;&lt;p&gt;åœ¨ React åº”ç”¨ä¸­è®¾ç½®å…¨å±€å´©æºƒæç¤ºé¡µé¢ï¼Œæ ¸å¿ƒæ˜¯é€šè¿‡ &lt;strong&gt;é”™è¯¯è¾¹ç•Œè¾¹ç•Œï¼ˆError Boundaryï¼‰&lt;/strong&gt; æ¥æ•è·å­ç»„ä»¶æ ‘ä¸­çš„ JavaScript é”™è¯¯ï¼Œå¹¶æ˜¾ç¤ºå¤‡ç”¨ UIã€‚ä»¥ä¸‹æ˜¯å…·" />
  <link rel="icon" href="../assets/favicon.svg" />
  <style>.content a{color:var(--brand);} .content img{max-width:100%;}</style>
  
  <!-- Open Graph -->
  <meta property="og:title" content="react å¼€å‘çš„åº”ç”¨é‡Œé¢ï¼Œ å¦‚ä½•ç»™ç³»ç»Ÿè®¾ç½®ä¸€ä¸ªå…¨å±€çš„å´©æºƒçš„æç¤ºé¡µé¢ã€çƒ­åº¦: 725ã€‘" />
  <meta property="og:type" content="article" />
  <meta property="og:description" content="&lt;p&gt;&lt;strong&gt;å…³é”®è¯&lt;/strong&gt;ï¼šå´©æºƒæç¤º&lt;/p&gt;&lt;p&gt;åœ¨ React åº”ç”¨ä¸­è®¾ç½®å…¨å±€å´©æºƒæç¤ºé¡µé¢ï¼Œæ ¸å¿ƒæ˜¯é€šè¿‡ &lt;strong&gt;é”™è¯¯è¾¹ç•Œè¾¹ç•Œï¼ˆError Boundaryï¼‰&lt;/strong&gt; æ¥æ•è·å­ç»„ä»¶æ ‘ä¸­çš„ JavaScript é”™è¯¯ï¼Œå¹¶æ˜¾ç¤ºå¤‡ç”¨ UIã€‚ä»¥ä¸‹æ˜¯å…·ä½“å®ç°æ–¹æ¡ˆï¼š&lt;/p&gt;&lt;h3&gt;å®ç°è¯´æ˜&lt;/h3&gt;&lt;ol&gt;&lt;li&gt;&lt;strong&gt;é”™è¯¯è¾¹ç•Œç»„ä»¶ï¼ˆErrorBoundaryï¼‰" />
  <meta property="og:locale" content="zh_CN" />
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <a class="logo" href="../index.html">é¢è¯•é¢˜åˆ·é¢˜</a>
      <nav class="nav">
        <a href="../index.html">é¦–é¡µ</a>
        <a href="../index.html#categories">åˆ†ç±»</a>
        <a href="https://github.com/pro-collection/interview-question/issues/1136" target="_blank" rel="noopener">åŸå§‹é“¾æ¥</a>
      </nav>
    </div>
  </header>
  <main class="container article">
    <div class="article-head">
      <a class="back" href="../index.html">â† è¿”å›åˆ—è¡¨</a>
      <h1>react å¼€å‘çš„åº”ç”¨é‡Œé¢ï¼Œ å¦‚ä½•ç»™ç³»ç»Ÿè®¾ç½®ä¸€ä¸ªå…¨å±€çš„å´©æºƒçš„æç¤ºé¡µé¢ã€çƒ­åº¦: 725ã€‘</h1>
      <div class="subtitle">webæ¡†æ¶ Â· webæ¡†æ¶ Â· å°ç±³</div>
      <div class="meta">åˆ›å»ºï¼š2025-08-31T10:36:12Z Â· æ›´æ–°ï¼š2025-08-31T10:36:12Z</div>
    </div>
    <article class="content markdown-body"><p><strong>å…³é”®è¯</strong>ï¼šå´©æºƒæç¤º</p><p>åœ¨ React åº”ç”¨ä¸­è®¾ç½®å…¨å±€å´©æºƒæç¤ºé¡µé¢ï¼Œæ ¸å¿ƒæ˜¯é€šè¿‡ <strong>é”™è¯¯è¾¹ç•Œè¾¹ç•Œï¼ˆError Boundaryï¼‰</strong> æ¥æ•è·å­ç»„ä»¶æ ‘ä¸­çš„ JavaScript é”™è¯¯ï¼Œå¹¶æ˜¾ç¤ºå¤‡ç”¨ UIã€‚ä»¥ä¸‹æ˜¯å…·ä½“å®ç°æ–¹æ¡ˆï¼š</p><h3>å®ç°è¯´æ˜</h3><ol><li><strong>é”™è¯¯è¾¹ç•Œç»„ä»¶ï¼ˆErrorBoundaryï¼‰</strong></li></ol><ul><li>è¿™æ˜¯ä¸€ä¸ª React ç±»ç»„ä»¶ï¼Œåˆ©ç”¨ React çš„é”™è¯¯æ•è·ç”Ÿå‘½å‘¨æœŸ <code>getDerivedStateFromError</code> å’Œ <code>componentDidCatch</code> æ•è·å­ç»„ä»¶é”™è¯¯</li><li><code>getDerivedStateFromError</code>ï¼šç”¨äºæ›´æ–°çŠ¶æ€ï¼Œè§¦å‘é”™è¯¯ UI æ¸²æŸ“</li><li><code>componentDidCatch</code>ï¼šç”¨äºè®°å½•é”™è¯¯ä¿¡æ¯ï¼ˆå¯ä¸ŠæŠ¥åˆ°æœåŠ¡ç«¯ï¼‰</li><li>æä¾›é‡è¯•å’Œè¿”å›é¦–é¡µåŠŸèƒ½ï¼Œæå‡ç”¨æˆ·ä½“éªŒ</li></ul><pre class="code-block"><code class="language-jsx">import React from &quot;react&quot;;
import { Button } from &quot;your-ui-library&quot;; // å¯æ›¿æ¢ä¸ºä½ çš„ UI åº“æˆ–è‡ªå®šä¹‰æŒ‰é’®

class ErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      hasError: false,
      error: null,
      errorInfo: null,
    };
  }

  // æ•è·å­ç»„ä»¶æ ‘ä¸­çš„é”™è¯¯
  static getDerivedStateFromError(error) {
    // æ›´æ–° stateï¼Œä¸‹ä¸€æ¬¡æ¸²æŸ“å°†æ˜¾ç¤ºé”™è¯¯ UI
    return { hasError: true };
  }

  // è®°å½•é”™è¯¯ä¿¡æ¯ï¼ˆå¯ç”¨äºä¸ŠæŠ¥ï¼‰
  componentDidCatch(error, errorInfo) {
    this.setState({
      error: error,
      errorInfo: errorInfo,
    });

    // å¯é€‰ï¼šå°†é”™è¯¯ä¿¡æ¯ä¸ŠæŠ¥åˆ°æœåŠ¡ç«¯
    console.error(&quot;å…¨å±€é”™è¯¯æ•è·:&quot;, error, errorInfo);
    // å®é™…é¡¹ç›®ä¸­å¯ä»¥è°ƒç”¨æ¥å£ä¸ŠæŠ¥ï¼š
    // fetch(&#39;/api/log-error&#39;, {
    //   method: &#39;POST&#39;,
    //   body: JSON.stringify({ error: error.message, stack: errorInfo.componentStack })
    // });
  }

  // é‡ç½®é”™è¯¯çŠ¶æ€ï¼ˆé‡æ–°åŠ è½½åº”ç”¨ï¼‰
  resetErrorHandler = () =&gt; {
    this.setState({
      hasError: false,
      error: null,
      errorInfo: null,
    });
    // å¯é€‰ï¼šå¦‚æœéœ€è¦å®Œå…¨é‡ç½®åº”ç”¨çŠ¶æ€ï¼Œå¯ä»¥åˆ·æ–°é¡µé¢
    // window.location.reload();
  };

  render() {
    if (this.state.hasError) {
      // é”™è¯¯å‘ç”Ÿæ—¶æ˜¾ç¤ºçš„å´©æºƒé¡µé¢
      return (
        &lt;div className=&quot;global-error-container&quot;&gt;
          &lt;div className=&quot;error-content&quot;&gt;
            &lt;h2&gt;ğŸ˜± åº”ç”¨å‘ç”Ÿé”™è¯¯&lt;/h2&gt;
            &lt;p&gt;å¾ˆæŠ±æ­‰ï¼Œé¡µé¢å‡ºç°äº†æ„å¤–é”™è¯¯ï¼Œè¯·å°è¯•åˆ·æ–°æˆ–è”ç³»ç®¡ç†å‘˜ã€‚&lt;/p&gt;

            {/* å¯é€‰ï¼šæ˜¾ç¤ºé”™è¯¯è¯¦æƒ…ï¼ˆç”Ÿäº§ç¯å¢ƒå¯éšè—ï¼‰ */}
            {process.env.NODE_ENV === &quot;development&quot; &amp;&amp; (
              &lt;details style={{ whiteSpace: &quot;pre-wrap&quot; }}&gt;
                &lt;summary&gt;é”™è¯¯è¯¦æƒ…&lt;/summary&gt;
                {this.state.error?.message}
                &lt;br /&gt;
                {this.state.errorInfo?.componentStack}
              &lt;/details&gt;
            )}

            &lt;div className=&quot;error-actions&quot;&gt;
              &lt;Button onClick={this.resetErrorHandler} variant=&quot;primary&quot;&gt;
                é‡è¯•
              &lt;/Button&gt;
              &lt;Button onClick={() =&gt; (window.location.href = &quot;/&quot;)} variant=&quot;secondary&quot; style={{ marginLeft: &quot;10px&quot; }}&gt;
                è¿”å›é¦–é¡µ
              &lt;/Button&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      );
    }

    // å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œæ¸²æŸ“å­ç»„ä»¶
    return this.props.children;
  }
}

export default ErrorBoundary;
</code></pre><ol><li><strong>å…¨å±€åº”ç”¨</strong></li></ol><ul><li>åœ¨åº”ç”¨å…¥å£ï¼ˆApp.jsxï¼‰ç”¨ ErrorBoundary åŒ…è£¹æ•´ä¸ªåº”ç”¨ï¼Œç¡®ä¿æ‰€æœ‰å­ç»„ä»¶çš„é”™è¯¯éƒ½èƒ½è¢«æ•è·</li><li>é”™è¯¯è¾¹ç•Œä¼šè‡ªåŠ¨æ•è·å…¶å†…éƒ¨æ‰€æœ‰ç»„ä»¶ï¼ˆåŒ…æ‹¬åµŒå¥—ç»„ä»¶ï¼‰çš„æ¸²æŸ“é”™è¯¯ã€ç”Ÿå‘½å‘¨æœŸé”™è¯¯ç­‰</li></ul><pre class="code-block"><code class="language-jsx">import React from &quot;react&quot;;
import ErrorBoundary from &quot;./ErrorBoundary&quot;;
import Router from &quot;./Router&quot;; // ä½ çš„è·¯ç”±ç»„ä»¶
import GlobalStyle from &quot;./GlobalStyle&quot;; // å…¨å±€æ ·å¼

function App() {
  return (
    // ç”¨é”™è¯¯è¾¹ç•ŒåŒ…è£¹æ•´ä¸ªåº”ç”¨
    &lt;ErrorBoundary&gt;
      &lt;GlobalStyle /&gt;
      &lt;Router /&gt;
    &lt;/ErrorBoundary&gt;
  );
}

export default App;
</code></pre><h3>æ³¨æ„äº‹é¡¹</h3><ul><li>é”™è¯¯è¾¹ç•Œ<strong>ä¸èƒ½æ•è·ä»¥ä¸‹é”™è¯¯</strong>ï¼š</li></ul><ul><li>äº‹ä»¶å¤„ç†å‡½æ•°ä¸­çš„é”™è¯¯ï¼ˆéœ€æ‰‹åŠ¨ try/catchï¼‰</li><li>å¼‚æ­¥ä»£ç ä¸­çš„é”™è¯¯ï¼ˆå¦‚ setTimeoutã€Promiseï¼‰</li><li>é”™è¯¯è¾¹ç•Œè‡ªèº«çš„é”™è¯¯</li><li>æœåŠ¡ç«¯æ¸²æŸ“çš„é”™è¯¯</li></ul><ul><li>å¯¹äºå¼‚æ­¥é”™è¯¯ï¼ˆå¦‚ API è¯·æ±‚å¤±è´¥ï¼‰ï¼Œéœ€è¦é¢å¤–åœ¨ä»£ç ä¸­å¤„ç†ï¼ˆå¦‚ try/catch æˆ–çŠ¶æ€ç®¡ç†ï¼‰</li></ul><ul><li>å¯ä»¥æ ¹æ®éœ€è¦æ‰©å±•é”™è¯¯è¾¹ç•Œï¼Œä¾‹å¦‚ï¼š</li><li>å¢åŠ é”™è¯¯åˆ†ç±»æ˜¾ç¤ºä¸åŒæç¤º</li><li>å®ç°è‡ªåŠ¨é‡è¯•é€»è¾‘</li><li>é›†æˆé”™è¯¯ç›‘æ§å·¥å…·ï¼ˆå¦‚ Sentryï¼‰</li></ul><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ çš„ React åº”ç”¨å°±èƒ½æ‹¥æœ‰ä¸€ä¸ªå…¨å±€çš„å´©æºƒå¤„ç†æœºåˆ¶ï¼Œåœ¨å‘ç”Ÿé”™è¯¯æ—¶ç»™ç”¨æˆ·å‹å¥½çš„æç¤ºï¼Œè€Œä¸æ˜¯ç™½å±æˆ–æ§åˆ¶å°æŠ¥é”™ã€‚</p></article>
  </main>
  <footer class="site-footer">Â© é¢è¯•é¢˜åˆ·é¢˜ Â· ç”±æœ¬åœ°é™æ€é¡µé¢ç”Ÿæˆ</footer>
</body>
</html>