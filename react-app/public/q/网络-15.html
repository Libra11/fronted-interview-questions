<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>JSONP 是如何实现跨域的? - 面试题刷题</title>
  <link rel="stylesheet" href="../assets/styles.css" />
  <meta name="description" content="&lt;h2&gt;JSONP&lt;/h2&gt;&lt;p&gt;JSONP 的实现原理是通过添加一个 script 标签，指定 src 属性为跨域请求的 URL，而这个 URL 返回的不是 JSON 数据，而是一段可执行的 JavaScript 代码，这段代码会调用一个指定的函数，并且将 JSON 数据作为参" />
  <link rel="icon" href="../assets/favicon.svg" />
  <style>.content a{color:var(--brand);} .content img{max-width:100%;}</style>
  
  <!-- Open Graph -->
  <meta property="og:title" content="JSONP 是如何实现跨域的?" />
  <meta property="og:type" content="article" />
  <meta property="og:description" content="&lt;h2&gt;JSONP&lt;/h2&gt;&lt;p&gt;JSONP 的实现原理是通过添加一个 script 标签，指定 src 属性为跨域请求的 URL，而这个 URL 返回的不是 JSON 数据，而是一段可执行的 JavaScript 代码，这段代码会调用一个指定的函数，并且将 JSON 数据作为参数传入函数中。&lt;/p&gt;&lt;p&gt;例如，假设我们从 http://example.com 域名下请求数据，我们可以通过在 ht" />
  <meta property="og:locale" content="zh_CN" />
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <a class="logo" href="../index.html">面试题刷题</a>
      <nav class="nav">
        <a href="../index.html">首页</a>
        <a href="../index.html#categories">分类</a>
        <a href="https://github.com/pro-collection/interview-question/issues/15" target="_blank" rel="noopener">原始链接</a>
      </nav>
    </div>
  </header>
  <main class="container article">
    <div class="article-head">
      <a class="back" href="../index.html">← 返回列表</a>
      <h1>JSONP 是如何实现跨域的?</h1>
      <div class="subtitle">网络 · 网络</div>
      <div class="meta">创建：2023-03-06T15:19:57Z · 更新：2023-03-06T15:19:58Z</div>
    </div>
    <article class="content markdown-body"><h2>JSONP</h2><p>JSONP 的实现原理是通过添加一个 script 标签，指定 src 属性为跨域请求的 URL，而这个 URL 返回的不是 JSON 数据，而是一段可执行的 JavaScript 代码，这段代码会调用一个指定的函数，并且将 JSON 数据作为参数传入函数中。</p><p>例如，假设我们从 http://example.com 域名下请求数据，我们可以通过在 http://example.com 中添加如下代码实现 JSONP 请求：</p><pre class="code-block"><code class="language-js">function handleData(data) {
  // 处理获取到的数据
}

const script = document.createElement(&#39;script&#39;);
script.src = &#39;http://example.org/api/data?callback=handleData&#39;;
document.head.appendChild(script);
</code></pre><p>其中，我们指定了一个名为 <code>handleData</code> 的回调函数，并将这个函数名作为参数传递给了跨域请求的 URL 中的 callback 参数。服务器端返回的数据将会被包装在这个回调函数中，例如：</p><pre class="code-block"><code class="language-js">handleData({&quot;name&quot;: &quot;John&quot;, &quot;age&quot;: 30});
</code></pre><p>在这个例子中，我们可以在 handleData 函数中处理获取到的数据。需要注意的是，在使用 JSONP 时，<strong>需要保证服务器端返回的数据是一个可执行的 JavaScript 代码，并且必须使用指定的回调函数名来包装数据，否则无法正确处理数据。</strong></p><h3>如何获取 jsonp 的相应参数</h3><p>获取 JSONP 响应结果的方法有两种，<strong>一种是通过回调函数参数获取</strong>，<strong>另一种是通过 script 标签加载完成后解析全局变量获取</strong>。</p><p>假设服务器返回以下 JSONP 响应：</p><pre class="code-block"><code class="language-js">callback({&quot;name&quot;: &quot;Alice&quot;, &quot;age&quot;: 20});
</code></pre><p>其中 callback 是客户端定义的回调函数名，用于指定返回数据的处理方式。</p><p>我们可以使用以下两种方式获取响应结果：</p><p><strong>1. 通过回调函数参数获取</strong></p><p>在客户端定义一个全局函数作为回调函数，服务器返回的数据会作为回调函数的参数传入，这个参数可以在回调函数中处理。</p><pre class="code-block"><code class="language-js">function handleResponse(data) {
  console.log(data.name); // Alice
  console.log(data.age); // 20
}

// 创建 script 标签
const script = document.createElement(&#39;script&#39;);
script.src = &#39;http://example.com/api?callback=handleResponse&#39;;

// 插入到文档中开始加载数据
document.body.appendChild(script);
</code></pre><p><strong>2. 通过全局变量获取</strong></p><p>在客户端定义一个全局函数作为回调函数，服务器返回的数据会作为一个全局变量赋值给该函数所在的对象，我们可以在 script 标签加载完成后解析全局变量获取响应结果。</p><pre class="code-block"><code class="language-js">function handleResponse() {
  console.log(myData.name); // Alice
  console.log(myData.age); // 20
}

// 创建 script 标签
const script = document.createElement(&#39;script&#39;);
script.src = &#39;http://example.com/api?callback=handleResponse&#39;;

// 插入到文档中开始加载数据
document.body.appendChild(script);

// script 标签加载完成后解析全局变量
window.myData = {};
script.onload = () =&gt; {
  delete window.myData; // 删除全局变量
};
</code></pre><p>注意，使用 JSONP 时要注意安全问题，应该对返回的数据进行验证，避免接收到恶意代码。此外，JSONP <strong>只能发送 GET 请求</strong>，无法发送 POST 请求，<strong>也无法使用 HTTP 请求头和请求体传递数据</strong>。</p></article>
  </main>
  <footer class="site-footer">© 面试题刷题 · 由本地静态页面生成</footer>
</body>
</html>