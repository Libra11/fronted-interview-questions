<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>js 宏任务与微任务都是指什么， 优先级如何？ - 面试题刷题</title>
  <link rel="stylesheet" href="../assets/styles.css" />
  <meta name="description" content="&lt;p&gt;在JavaScript中，宏任务（macro-task）和微任务（micro-task）是指异步操作的两种类型。&lt;/p&gt;&lt;h2&gt;基本操作&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;宏任务通常包括以下操作：&lt;/strong&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;setTimeout和setInterv" />
  <link rel="icon" href="../assets/favicon.svg" />
  <style>.content a{color:var(--brand);} .content img{max-width:100%;}</style>
  
  <!-- Open Graph -->
  <meta property="og:title" content="js 宏任务与微任务都是指什么， 优先级如何？" />
  <meta property="og:type" content="article" />
  <meta property="og:description" content="&lt;p&gt;在JavaScript中，宏任务（macro-task）和微任务（micro-task）是指异步操作的两种类型。&lt;/p&gt;&lt;h2&gt;基本操作&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;宏任务通常包括以下操作：&lt;/strong&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;setTimeout和setInterval定时器回调函数&lt;/li&gt;&lt;li&gt;事件回调函数（例如，鼠标点击、键盘输入等）&lt;/li&gt;&lt;li&gt;AJAX请求的回调函数&lt;" />
  <meta property="og:locale" content="zh_CN" />
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <a class="logo" href="../index.html">面试题刷题</a>
      <nav class="nav">
        <a href="../index.html">首页</a>
        <a href="../index.html#categories">分类</a>
        <a href="https://github.com/pro-collection/interview-question/issues/47" target="_blank" rel="noopener">原始链接</a>
      </nav>
    </div>
  </header>
  <main class="container article">
    <div class="article-head">
      <a class="back" href="../index.html">← 返回列表</a>
      <h1>js 宏任务与微任务都是指什么， 优先级如何？</h1>
      <div class="subtitle">JavaScript · JavaScript</div>
      <div class="meta">创建：2023-03-09T15:54:34Z · 更新：2025-02-20T04:32:27Z</div>
    </div>
    <article class="content markdown-body"><p>在JavaScript中，宏任务（macro-task）和微任务（micro-task）是指异步操作的两种类型。</p><h2>基本操作</h2><p><strong>宏任务通常包括以下操作：</strong></p><ul><li>setTimeout和setInterval定时器回调函数</li><li>事件回调函数（例如，鼠标点击、键盘输入等）</li><li>AJAX请求的回调函数</li><li>请求动画帧（requestAnimationFrame）回调函数</li><li>script标签的onload和onerror事件</li></ul><p>当一个宏任务开始执行时，JavaScript 引擎会将其放入调用堆栈的底部，然后继续执行其他代码。当调用堆栈为空时，JavaScript引擎会取出下一个宏任务并执行。</p><p><strong>微任务通常包括以下操作：</strong></p><ul><li>Promise的回调函数</li><li>Generator函数</li><li>MutationObserver 的回调函数</li><li>process.nextTick（Node.js环境下）</li></ul><p>当一个微任务被添加到任务队列中时，它会在当前宏任务执行完成后立即执行，而不是等待下一个宏任务开始执行。这使得微任务可以在当前宏任务执行期间处理异步操作的结果，从而提高应用程序的响应性能。</p><h2>宏任务与微任务的优先级是怎样的？</h2><p>在 JavaScript 中，宏任务和微任务的执行优先级是不同的。<strong>通常情况下，微任务的优先级高于宏任务</strong>，也就是说，在一个宏任务中，如果有微任务存在，那么微任务会优先于宏任务执行。</p><p>具体来说，当一个宏任务开始执行时，如果在它的执行过程中产生了微任务，那么这些微任务会被添加到微任务队列中，等待当前宏任务执行完成后立即执行。如果在这个过程中产生了新的微任务，则会一直执行微任务，直到微任务队列为空，然后JavaScript引擎才会继续执行下一个宏任务。</p><p>例如，以下代码演示了宏任务和微任务的执行顺序：</p><pre class="code-block"><code class="language-js">console.log(&#39;start&#39;);

setTimeout(function() {
  console.log(&#39;setTimeout&#39;);
}, 0);

Promise.resolve().then(function() {
  console.log(&#39;promise&#39;);
});

console.log(&#39;end&#39;);
</code></pre><p>上述代码中，先执行同步代码 console.log('start') 和 console.log('end')。接着，使用 setTimeout 添加一个宏任务，然后使用 Promise.resolve().then 添加一个微任务。由于微任务优先级高于宏任务，因此 Promise 的回调函数会在 setTimeout 回调函数之前执行。因此，上述代码的输出顺序如下：</p><pre class="code-block"><code>start
end
promise
setTimeout
</code></pre><h2>Comments / Answers</h2><hr /><p><strong>BruceYuj</strong> at 2025-02-20T04:32:26Z</p><p>从 HTML 规范来看，<code>requestAnimationFrame</code> 既不属于 microtask 也不属于 macrotask。推广来讲，和渲染相关的操作都不属于 macrotask 和 microtask。其触发时间由浏览器决定。</p><ol><li><strong>执行一个 macrotask</strong>（如主代码、<code>setTimeout</code> 回调等）。</li><li><strong>执行所有 microtask</strong>：</li></ol><ul><li>依次执行队列中的每个 microtask。</li><li>若执行过程中产生新的 microtask，继续处理，直到队列清空。</li></ul><ol><li><strong>UI 渲染</strong>（如有需要）。</li><li><strong>重复循环</strong>，处理下一个 macrotask。</li></ol><p>而是否渲染是根据实际情况来决定的。</p><pre class="code-block"><code class="language-javascript">Promise.resolve().then(() =&gt; console.log(&#39;Microtask&#39;));
setTimeout(() =&gt; console.log(&#39;Macrotask&#39;));
requestAnimationFrame(() =&gt; console.log(&#39;RAF&#39;));
// 输出顺序：Microtask → RAF → Macrotask 或者 Microtask -&gt; Macrotask -&gt; RAF
</code></pre><p>代码验证两种输出都有可能</p></article>
  </main>
  <footer class="site-footer">© 面试题刷题 · 由本地静态页面生成</footer>
</body>
</html>