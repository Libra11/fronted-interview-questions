<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>axios 如何取消请求【热度: 218】 - 面试题刷题</title>
  <link rel="stylesheet" href="../assets/styles.css" />
  <meta name="description" content="&lt;p&gt;&lt;strong&gt;关键词&lt;/strong&gt;：axios 取消请求&lt;/p&gt;&lt;blockquote&gt;作者备注&lt;/blockquote&gt;&lt;blockquote&gt;&lt;/blockquote&gt;&lt;blockquote&gt;新版本已经废弃使用 cancelToken ，改为使用 signal&lt;/" />
  <link rel="icon" href="../assets/favicon.svg" />
  <style>.content a{color:var(--brand);} .content img{max-width:100%;}</style>
  
  <!-- Open Graph -->
  <meta property="og:title" content="axios 如何取消请求【热度: 218】" />
  <meta property="og:type" content="article" />
  <meta property="og:description" content="&lt;p&gt;&lt;strong&gt;关键词&lt;/strong&gt;：axios 取消请求&lt;/p&gt;&lt;blockquote&gt;作者备注&lt;/blockquote&gt;&lt;blockquote&gt;&lt;/blockquote&gt;&lt;blockquote&gt;新版本已经废弃使用 cancelToken ，改为使用 signal&lt;/blockquote&gt;&lt;blockquote&gt;&lt;/blockquote&gt;&lt;blockquote&gt;可以参考官网：https" />
  <meta property="og:locale" content="zh_CN" />
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <a class="logo" href="../index.html">面试题刷题</a>
      <nav class="nav">
        <a href="../index.html">首页</a>
        <a href="../index.html#categories">分类</a>
        <a href="https://github.com/pro-collection/interview-question/issues/950" target="_blank" rel="noopener">原始链接</a>
      </nav>
    </div>
  </header>
  <main class="container article">
    <div class="article-head">
      <a class="back" href="../index.html">← 返回列表</a>
      <h1>axios 如何取消请求【热度: 218】</h1>
      <div class="subtitle">web应用场景 · 网络 · web应用场景</div>
      <div class="meta">创建：2024-09-28T03:00:40Z · 更新：2024-09-28T03:00:41Z</div>
    </div>
    <article class="content markdown-body"><p><strong>关键词</strong>：axios 取消请求</p><blockquote>作者备注</blockquote><blockquote></blockquote><blockquote>新版本已经废弃使用 cancelToken ，改为使用 signal</blockquote><blockquote></blockquote><blockquote>可以参考官网：https://axios-http.com/docs/cancellation</blockquote><h3>取消请求</h3><p><code>timeout</code>在 axios 调用中设置属性<strong>可处理响应</strong>相关的超时。</p><p>在某些情况下（例如网络连接不可用），提前取消连接对 axios<strong>调用</strong>大有裨益。如果不取消连接，axios 调用可能会挂起，直到父代码/堆栈超时（在服务器端应用程序中可能需要几分钟）。</p><p>要终止 axios 调用，您可以使用以下方法：</p><ul><li><code>signal</code></li><li><code>cancelToken</code>（已弃用）</li></ul><p>组合<code>timeout</code>和取消方法（例如<code>signal</code>）应该涵盖<strong>响应</strong>相关的超时和<strong>连接</strong>相关的超时。</p><h3><code>signal</code>：中止控制器</h3><p>从<code>v0.22.0</code>Axios 开始支持<a href="https://developer.mozilla.org/en-US/docs/Web/API/AbortController" target="_blank" rel="noopener"><code>AbortController</code></a>以 fetch API 方式取消请求：</p><pre class="code-block"><code class="language-js">const controller = new AbortController();

axios
  .get(&quot;/foo/bar&quot;, {
    signal: controller.signal,
  })
  .then(function (response) {
    //...
  });
// cancel the request
controller.abort();
</code></pre><p>使用最新 API <code>nodejs 17.3+</code>. 的超时示例<a href="https://developer.mozilla.org/en-US/docs/Web/API/AbortSignal/timeout" target="_blank" rel="noopener"><code>AbortSignal.timeout()</code></a>：</p><pre class="code-block"><code class="language-js">axios
  .get(&quot;/foo/bar&quot;, {
    signal: AbortSignal.timeout(5000), //Aborts request after 5 seconds
  })
  .then(function (response) {
    //...
  });
</code></pre><p>具有超时辅助函数的示例：</p><pre class="code-block"><code class="language-js">function newAbortSignal(timeoutMs) {
  const abortController = new AbortController();
  setTimeout(() =&gt; abortController.abort(), timeoutMs || 0);

  return abortController.signal;
}

axios
  .get(&quot;/foo/bar&quot;, {
    signal: newAbortSignal(5000), //Aborts request after 5 seconds
  })
  .then(function (response) {
    //...
  });
</code></pre><h3>取消令牌<code>deprecated</code></h3><p>还可以使用 CancelToken\_取消请求。</p><blockquote>Axios 取消令牌 API 基于已撤回的<a href="https://github.com/tc39/proposal-cancelable-promises" target="_blank" rel="noopener">可取消承诺提案</a>。</blockquote><blockquote>此 API 已弃用<code>v0.22.0</code>，不应在新项目中使用</blockquote><p>您可以使用工厂创建取消令牌<code>CancelToken.source</code>，如下所示：</p><pre class="code-block"><code class="language-js">const CancelToken = axios.CancelToken;
const source = CancelToken.source();

axios
  .get(&quot;/user/12345&quot;, {
    cancelToken: source.token,
  })
  .catch(function (thrown) {
    if (axios.isCancel(thrown)) {
      console.log(&quot;Request canceled&quot;, thrown.message);
    } else {
      // handle error
    }
  });

axios.post(
  &quot;/user/12345&quot;,
  {
    name: &quot;new name&quot;,
  },
  {
    cancelToken: source.token,
  }
);

// cancel the request (the message parameter is optional)
source.cancel(&quot;Operation canceled by the user.&quot;);
</code></pre><p>您还可以通过将执行器函数传递给构造函数来创建取消令牌<code>CancelToken</code>：</p><pre class="code-block"><code class="language-js">const CancelToken = axios.CancelToken;
let cancel;

axios.get(&quot;/user/12345&quot;, {
  cancelToken: new CancelToken(function executor(c) {
    // An executor function receives a cancel function as a parameter
    cancel = c;
  }),
});

// cancel the request
cancel();
</code></pre><blockquote>注意：您可以使用相同的取消令牌/信号取消多个请求。</blockquote><p>在过渡期间，你可以使用这两个取消 API，即使对于同一个请求也是如此：</p><pre class="code-block"><code class="language-js">const controller = new AbortController();

const CancelToken = axios.CancelToken;
const source = CancelToken.source();

axios
  .get(&quot;/user/12345&quot;, {
    cancelToken: source.token,
    signal: controller.signal,
  })
  .catch(function (thrown) {
    if (axios.isCancel(thrown)) {
      console.log(&quot;Request canceled&quot;, thrown.message);
    } else {
      // handle error
    }
  });

axios.post(
  &quot;/user/12345&quot;,
  {
    name: &quot;new name&quot;,
  },
  {
    cancelToken: source.token,
  }
);

// cancel the request (the message parameter is optional)
source.cancel(&quot;Operation canceled by the user.&quot;);
// OR
controller.abort(); // the message parameter is not supported
</code></pre></article>
  </main>
  <footer class="site-footer">© 面试题刷题 · 由本地静态页面生成</footer>
</body>
</html>