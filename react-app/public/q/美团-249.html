<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>[webpack] 如果解决重复引用 node_modules 里面的不同版本的包(包重复问题) - 面试题刷题</title>
  <link rel="stylesheet" href="../assets/styles.css" />
  <meta name="description" content="&lt;p&gt;解决重复引用 &lt;code&gt;node_modules&lt;/code&gt; 中不同版本的包的问题，可以通过以下几种方式：&lt;/p&gt;&lt;p&gt;&lt;strong&gt;1.使用 npm 或者 yarn 的工具进行依赖的版本控制，尽量避免引用不同版本的同一个依赖库&lt;/strong&gt;。在 package." />
  <link rel="icon" href="../assets/favicon.svg" />
  <style>.content a{color:var(--brand);} .content img{max-width:100%;}</style>
  
  <!-- Open Graph -->
  <meta property="og:title" content="[webpack] 如果解决重复引用 node_modules 里面的不同版本的包(包重复问题)" />
  <meta property="og:type" content="article" />
  <meta property="og:description" content="&lt;p&gt;解决重复引用 &lt;code&gt;node_modules&lt;/code&gt; 中不同版本的包的问题，可以通过以下几种方式：&lt;/p&gt;&lt;p&gt;&lt;strong&gt;1.使用 npm 或者 yarn 的工具进行依赖的版本控制，尽量避免引用不同版本的同一个依赖库&lt;/strong&gt;。在 package.json 文件中使用 &quot;^&quot;、&quot;~&quot;、&quot;&gt;=&quot; 等方式指定依赖版本，可以有效减少不同版本的包冲突问题。&lt;/p&gt;&lt;p&gt;&lt;s" />
  <meta property="og:locale" content="zh_CN" />
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <a class="logo" href="../index.html">面试题刷题</a>
      <nav class="nav">
        <a href="../index.html">首页</a>
        <a href="../index.html#categories">分类</a>
        <a href="https://github.com/pro-collection/interview-question/issues/249" target="_blank" rel="noopener">原始链接</a>
      </nav>
    </div>
  </header>
  <main class="container article">
    <div class="article-head">
      <a class="back" href="../index.html">← 返回列表</a>
      <h1>[webpack] 如果解决重复引用 node_modules 里面的不同版本的包(包重复问题)</h1>
      <div class="subtitle">美团 · 工程化 · 美团</div>
      <div class="meta">创建：2023-04-03T01:18:02Z · 更新：2023-04-26T15:20:48Z</div>
    </div>
    <article class="content markdown-body"><p>解决重复引用 <code>node_modules</code> 中不同版本的包的问题，可以通过以下几种方式：</p><p><strong>1.使用 npm 或者 yarn 的工具进行依赖的版本控制，尽量避免引用不同版本的同一个依赖库</strong>。在 package.json 文件中使用 "^"、"~"、">=" 等方式指定依赖版本，可以有效减少不同版本的包冲突问题。</p><p><strong>2.使用 webpack 的 resolve.alias 配置选项</strong>，将需要共享的模块指定到一个目录下，然后在其它模块中使用别名引用该模块。例如，将需要共享的模块指定到 src/shared 目录下，然后在其它模块中使用别名 @shared 引用该模块，这样就可以保证在不同模块中引用相同的依赖库。</p><p>假设我们在项目中同时依赖了两个库：<code>lodash</code> 和 <code>lodash-es</code>，并且它们分别被安装在了不同的目录下，如下所示：</p><pre class="code-block"><code>Copy codenode_modules/
├── lodash/
└── lodash-es/
</code></pre><p>我们需要在项目中同时引用这两个库，但是如果我们在代码中分别使用 <code>import _ from &#39;lodash&#39;</code> 和 <code>import _ from &#39;lodash-es&#39;</code>，那么 webpack 会将它们打包成两个独立的模块，导致代码体积变大。</p><p>为了解决这个问题，我们可以通过 <code>resolve.alias</code> 配置项将它们指向同一个模块。具体做法是在 webpack 配置文件中添加以下内容：</p><pre class="code-block"><code class="language-js">module.exports = {
  // ...
  resolve: {
    alias: {
      &#39;lodash-es&#39;: &#39;lodash&#39;
    }
  }
}
</code></pre><p>这样一来，当我们在代码中使用 <code>import _ from &#39;lodash-es&#39;</code> 时，webpack 会自动将它解析成对 <code>lodash</code> 的引用，从而避免了重复打包的问题。</p><p><strong>3.使用 webpack 的 ProvidePlugin 插件</strong>，将需要共享的模块注入到全局作用域中，这样就可以在不同模块中共享相同的依赖库。例如，在 webpack 配置文件中添加以下代码：</p><pre class="code-block"><code class="language-javascript">const webpack = require(&#39;webpack&#39;);

module.exports = {
  // ...
  plugins: [
    new webpack.ProvidePlugin({
      $: &#39;jquery&#39;,
      jQuery: &#39;jquery&#39;,
      &#39;window.jQuery&#39;: &#39;jquery&#39;,
    }),
  ],
};
</code></pre><p>这样在不同模块中就可以使用 $、jQuery、window.jQuery 全局变量引用 jquery 依赖库，避免了重复引用不同版本的 jquery 包的问题。</p><p><strong>4.使用 webpack 的 resolve.modules 配置选项</strong>，将 node\_modules 目录移动到项目根目录之外，然后在 resolve.modules 中添加该目录的绝对路径，这样就可以解决不同模块中引用相同依赖库不同版本的问题。例如，在 webpack 配置文件中添加以下代码：</p><pre class="code-block"><code class="language-javascript">const path = require(&#39;path&#39;);

module.exports = {
  // ...
  resolve: {
    modules: [
      path.resolve(__dirname, &#39;src&#39;),
      &#39;node_modules&#39;,
    ],
  },
};
</code></pre><p>这样 webpack 在查找依赖库的时候，会先在项目根目录下的 src 目录中查找，如果没有找到再去 node\_modules 目录中查找，避免了不同模块中引用相同依赖库不同版本的问题。</p><h2>Comments / Answers</h2><hr /><p><strong>HSQCoollaughing</strong> at 2023-04-03T01:23:28Z</p><p>可以使用 npm 的 dedupe 命令来解决重复引用 node_modules 里面的不同版本的包。该命令可以将多个版本的同一个包合并为一个，并将所有依赖该包的模块都指向同一个版本。</p><p>具体操作步骤如下：</p><ol><li>进入项目根目录，在命令行中输入 npm dedupe。</li></ol><ol><li>等待 dedupe 命令执行完毕。</li></ol><ol><li>检查项目的 package.json 文件中是否存在重复的依赖项。</li></ol><ol><li>如果存在重复的依赖项，手动将其合并为一个，并删除 package-lock.json 文件。</li></ol><ol><li>重新安装项目的依赖项，执行 npm install 命令。</li></ol><ol><li>检查项目是否能够正常运行，如果出现错误，则需要手动修改代码或依赖项版本。</li></ol><p>总之，通过 dedupe 命令可以有效解决 node_modules 中重复引用的问题，提高项目的稳定性和可维护性。</p></article>
  </main>
  <footer class="site-footer">© 面试题刷题 · 由本地静态页面生成</footer>
</body>
</html>