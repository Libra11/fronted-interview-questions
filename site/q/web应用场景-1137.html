<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SPA 的 history 路由模式在 Nginx 部署时刷新 404，如何配置解决【热度: 488】 - 面试题刷题</title>
  <link rel="stylesheet" href="../assets/styles.css" />
  <meta name="description" content="&lt;p&gt;&lt;strong&gt;关键词&lt;/strong&gt;：nginx 刷新 404&lt;/p&gt;&lt;p&gt;要解决 SPA（单页应用）History 路由模式在 Nginx 部署时刷新 404 的问题，核心是理解 &lt;strong&gt;History 路由的原理缺陷&lt;/strong&gt; 与 &lt;strong&gt;N" />
  <link rel="icon" href="../assets/favicon.svg" />
  <style>.content a{color:var(--brand);} .content img{max-width:100%;}</style>
  
  <!-- Open Graph -->
  <meta property="og:title" content="SPA 的 history 路由模式在 Nginx 部署时刷新 404，如何配置解决【热度: 488】" />
  <meta property="og:type" content="article" />
  <meta property="og:description" content="&lt;p&gt;&lt;strong&gt;关键词&lt;/strong&gt;：nginx 刷新 404&lt;/p&gt;&lt;p&gt;要解决 SPA（单页应用）History 路由模式在 Nginx 部署时刷新 404 的问题，核心是理解 &lt;strong&gt;History 路由的原理缺陷&lt;/strong&gt; 与 &lt;strong&gt;Nginx 的请求匹配逻辑&lt;/strong&gt;，再通过针对性配置让所有路由请求都指向 SPA 的入口文件（通常是 &lt;code" />
  <meta property="og:locale" content="zh_CN" />
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <a class="logo" href="../index.html">面试题刷题</a>
      <nav class="nav">
        <a href="../index.html">首页</a>
        <a href="../index.html#categories">分类</a>
        <a href="https://github.com/pro-collection/interview-question/issues/1137" target="_blank" rel="noopener">原始链接</a>
      </nav>
    </div>
  </header>
  <main class="container article">
    <div class="article-head">
      <a class="back" href="../index.html">← 返回列表</a>
      <h1>SPA 的 history 路由模式在 Nginx 部署时刷新 404，如何配置解决【热度: 488】</h1>
      <div class="subtitle">web应用场景 · web应用场景</div>
      <div class="meta">创建：2025-09-07T05:51:21Z · 更新：2025-09-07T05:51:21Z</div>
    </div>
    <article class="content markdown-body"><p><strong>关键词</strong>：nginx 刷新 404</p><p>要解决 SPA（单页应用）History 路由模式在 Nginx 部署时刷新 404 的问题，核心是理解 <strong>History 路由的原理缺陷</strong> 与 <strong>Nginx 的请求匹配逻辑</strong>，再通过针对性配置让所有路由请求都指向 SPA 的入口文件（通常是 <code>index.html</code>）。以下是完整解决方案：</p><h3>一、问题根源：为什么会出现 404？</h3><p>首先要明确 SPA 两种路由模式的本质差异，这是理解问题的关键：</p><p>| 路由模式               | 原理                                                                                                                          | 部署后刷新行为                                                                                         |</p><p>| ---------------------- | ----------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------ |</p><p>| Hash 模式（<code>#</code>）       | 路由信息包含在 URL 的 <code>#</code> 后（如 <code>https://xxx.com/#/about</code>），<code>#</code> 后的内容不会发送给服务器，所有请求本质都是访问根路径（<code>/</code>） | 刷新时服务器只接收 <code>/</code> 请求，返回 <code>index.html</code>，SPA 再解析 <code>#</code> 后的路由，<strong>不会 404</strong>                  |</p><p>| History 模式（无 <code>#</code>） | 路由信息是真实 URL 路径（如 <code>https://xxx.com/about</code>），刷新时浏览器会将完整路径（<code>/about</code>）发送给服务器                       | Nginx 会查找 <code>/about</code> 对应的物理文件/目录，而 SPA 只有 <code>index.html</code> 一个入口文件，找不到就返回 <strong>404</strong> |</p><h3>二、解决方案：Nginx 核心配置</h3><p>核心思路：<strong>让 Nginx 接收到所有 SPA 路由相关的请求时，都返回入口文件 <code>index.html</code></strong>，由 SPA 框架（Vue/React/Angular 等）再解析具体路由。</p><h4>1. 基础配置（通用版）</h4><p>在 Nginx 的 <code>server</code> 块中，通过 <code>try_files</code> 指令实现“优先匹配物理文件，匹配不到则返回 <code>index.html</code>”：</p><pre class="code-block"><code class="language-nginx">server {
    listen 80;                  # 监听端口（根据实际情况调整，如 443 用于 HTTPS）
    server_name your-domain.com; # 你的域名（如 localhost 用于本地测试）
    root /path/to/your/spa;     # SPA 打包后文件的根目录（绝对路径，如 /usr/local/nginx/html/spa）
    index index.html;           # 默认入口文件

    # 关键配置：解决 History 路由刷新 404
    location / {
        # try_files 逻辑：先尝试访问 $uri（当前请求路径对应的物理文件）
        # 再尝试访问 $uri/（当前请求路径对应的目录）
        # 最后都找不到时，重定向到 /index.html（SPA 入口）
        try_files $uri $uri/ /index.html;
    }
}
</code></pre><h4>2. 进阶配置（处理子路径部署）</h4><p>如果 SPA 不是部署在域名根路径（如 <code>https://xxx.com/admin</code>，而非 <code>https://xxx.com</code>），需调整 <code>location</code> 匹配规则和 <code>try_files</code> 目标路径，避免路由错乱：</p><pre class="code-block"><code class="language-nginx">server {
    listen 80;
    server_name your-domain.com;
    root /path/to/your/project; # 注意：这里是父目录（包含 admin 子目录）
    index index.html;

    # 匹配所有以 /admin 开头的请求（SPA 部署在 /admin 子路径）
    location /admin {
        # 1. 先尝试访问子路径下的物理文件（如 /admin/static/css/main.css）
        # 2. 再尝试访问子路径下的目录
        # 3. 最后重定向到 /admin/index.html（子路径下的入口文件，而非根目录）
        try_files $uri $uri/ /admin/index.html;

        # 可选：如果 SPA 框架需要 base 路径，需在框架配置中同步设置
        # 例：Vue 需配置 publicPath: &#39;/admin/&#39;，React 需配置 homepage: &#39;/admin/&#39;
    }
}
</code></pre><h3>三、注意事项（避坑点）</h3><ol><li><strong>路径正确性</strong>：</li></ol><ul><li><code>root</code> 指令必须指向 SPA 打包后文件的 <strong>实际绝对路径</strong>（如 Linux 下的 <code>/var/www/spa</code>，Windows 下的 <code>D:/nginx/html/spa</code>），错误路径会导致 Nginx 找不到 <code>index.html</code>。</li><li>子路径部署时，<code>try_files</code> 最后一个参数必须是 <strong>完整的子路径入口（如 /admin/index.html）</strong>，不能写 <code>/index.html</code>（会指向根目录，导致 404）。</li></ul><ol><li><strong>HTTPS 场景适配</strong>：</li></ol><p>如果网站使用 HTTPS（<code>listen 443 ssl</code>），配置逻辑完全一致，只需在 <code>server</code> 块中补充 SSL 证书相关配置，不影响路由处理：</p><p>```nginx</p><p>server {</p><p>listen 443 ssl;</p><p>server_name your-domain.com;</p><p>ssl_certificate /path/to/cert.pem;   # SSL 证书路径</p><p>ssl_certificate_key /path/to/key.pem; # 证书私钥路径</p><p>root /path/to/your/spa;</p><p>index index.html;</p><p>location / {</p><p>try_files $uri $uri/ /index.html;</p><p>}</p><p>}</p><p>```</p><ol><li><strong>配置生效方式</strong>：</li></ol><p>修改 Nginx 配置后，需执行以下命令让配置生效（避免重启服务导致短暂 downtime）：</p><p>```bash</p><p># 1. 测试配置是否有语法错误（必须先执行，避免配置错误导致 Nginx 启动失败）</p><p>nginx -t</p><p># 2. 重新加载配置（平滑生效，不中断现有连接）</p><p>nginx -s reload</p><p>```</p><ol><li><strong>与后端接口的冲突处理</strong>：</li></ol><p>如果 SPA 同时有后端接口请求（如 <code>/api</code> 开头的接口），需在 Nginx 中优先匹配接口路径，避免接口请求被转发到 <code>index.html</code>。配置示例：</p><p>```nginx</p><p>server {</p><p># ... 其他基础配置 ...</p><p># 第一步：优先匹配后端接口（/api 开头的请求），转发到后端服务</p><p>location /api {</p><p>proxy_pass http://your-backend-server:port; # 后端服务地址（如 http://127.0.0.1:3000）</p><p>proxy_set_header Host $host;               # 传递 Host 头信息</p><p>proxy_set_header X-Real-IP $remote_addr;   # 传递真实客户端 IP</p><p>}</p><p># 第二步：剩余请求（SPA 路由）转发到 index.html</p><p>location / {</p><p>try_files $uri $uri/ /index.html;</p><p>}</p><p>}</p><p>```</p><h3>四、原理总结</h3><p>通过 <code>try_files $uri $uri/ /index.html</code> 这行核心配置，Nginx 实现了：</p><ol><li>优先处理 <strong>静态资源请求</strong>（如 <code>css</code>、<code>js</code>、<code>img</code>）：如果请求路径对应物理文件（如 <code>/static/css/main.css</code>），则直接返回该文件。</li><li>兜底处理 <strong>SPA 路由请求</strong>：如果请求路径不对应任何物理文件（如 <code>/about</code>、<code>/user/123</code>），则返回 <code>index.html</code>，由 SPA 框架根据 URL 解析并渲染对应的页面，从而解决刷新 404 问题。</li></ol></article>
  </main>
  <footer class="site-footer">© 面试题刷题 · 由本地静态页面生成</footer>
</body>
</html>