<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>[React] hooks 和 memorizedState 是什么关系?【热度: 836】 - 面试题刷题</title>
  <link rel="stylesheet" href="../assets/styles.css" />
  <meta name="description" content="&lt;p&gt;&lt;strong&gt;关键词&lt;/strong&gt;：memorizedState、添加和管理状态&lt;/p&gt;&lt;p&gt;&lt;strong&gt;hooks 和 memorizedState 之间的关系&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;在React中，Hooks是一种特殊的函数，用于在函数组件中添加和管理" />
  <link rel="icon" href="../assets/favicon.svg" />
  <style>.content a{color:var(--brand);} .content img{max-width:100%;}</style>
  
  <!-- Open Graph -->
  <meta property="og:title" content="[React] hooks 和 memorizedState 是什么关系?【热度: 836】" />
  <meta property="og:type" content="article" />
  <meta property="og:description" content="&lt;p&gt;&lt;strong&gt;关键词&lt;/strong&gt;：memorizedState、添加和管理状态&lt;/p&gt;&lt;p&gt;&lt;strong&gt;hooks 和 memorizedState 之间的关系&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;在React中，Hooks是一种特殊的函数，用于在函数组件中添加和管理状态以及其他React特性。而&lt;code&gt;memorizedState&lt;/code&gt;是React内部用于存储和管理Hoo" />
  <meta property="og:locale" content="zh_CN" />
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <a class="logo" href="../index.html">面试题刷题</a>
      <nav class="nav">
        <a href="../index.html">首页</a>
        <a href="../index.html#categories">分类</a>
        <a href="https://github.com/pro-collection/interview-question/issues/504" target="_blank" rel="noopener">原始链接</a>
      </nav>
    </div>
  </header>
  <main class="container article">
    <div class="article-head">
      <a class="back" href="../index.html">← 返回列表</a>
      <h1>[React] hooks 和 memorizedState 是什么关系?【热度: 836】</h1>
      <div class="subtitle">PDD · web框架 · PDD</div>
      <div class="meta">创建：2023-08-02T15:50:15Z · 更新：2023-08-02T15:53:49Z</div>
    </div>
    <article class="content markdown-body"><p><strong>关键词</strong>：memorizedState、添加和管理状态</p><p><strong>hooks 和 memorizedState 之间的关系</strong></p><p>在React中，Hooks是一种特殊的函数，用于在函数组件中添加和管理状态以及其他React特性。而<code>memorizedState</code>是React内部用于存储和管理Hooks状态的数据结构。</p><p>当你在函数组件中使用Hooks（如<code>useState</code>、<code>useEffect</code>等）时，React会在组件首次渲染时创建一个<code>memorizedState</code>链表。这个链表中的节点包含了组件的各个状态值。</p><p>每个节点都包含了两个重要的属性：<code>memoizedState</code>和<code>next</code>。<code>memoizedState</code>是该节点对应的状态值，而<code>next</code>是指向下一个节点的指针。这样就形成了一个链表，其中的节点对应于组件中的不同状态。</p><p>当组件重新渲染时，React会通过<code>memorizedState</code>链表找到与组件对应的节点，并将其中的状态值返回给组件。当调用状态更新的函数时，React会在<code>memorizedState</code>链表中找到与组件对应的节点，并将其中的状态值更新为新的值。</p><p>因此，Hooks和<code>memorizedState</code>是紧密相关的，Hooks通过<code>memorizedState</code>实现了状态的管理和更新。这种关系使得在函数组件中使用Hooks能够实现声明式的、可持久的状态管理，并且方便React进行性能优化。</p><p><strong>hooks 和 memorizedState 是怎么关联起来的？</strong></p><p>在React中，Hooks和<code>memorizedState</code>通过一种特殊的数据结构关联起来，这个数据结构被称为Fiber节点。</p><p>每个函数组件都对应一个Fiber节点，Fiber节点中包含了组件的各种信息，包括组件的状态（<code>memorizedState</code>）、props、子节点等。</p><p>当一个函数组件被调用时，React会创建一个新的Fiber节点，并将其与函数组件关联起来。在这个Fiber节点中，React会通过<code>memoizedState</code>属性存储组件的状态值。</p><p>当函数组件重新渲染时，React会更新对应的Fiber节点。在更新过程中，React会根据函数组件中的Hooks调用顺序，遍历<code>memorizedState</code>链表中的节点。</p><p>React会根据Hooks调用的顺序，将当前的<code>memorizedState</code>链表中的节点与新的Hooks调用结果进行比较，并更新<code>memoizedState</code>中的值。</p><p>这个过程中，React会使用一些算法来比较和更新<code>memorizedState</code>链表中的节点，以确保状态的正确性和一致性。例如，React可能会使用链表的插入、删除、移动等操作来更新<code>memorizedState</code>链表。</p><p>通过这样的机制，Hooks和<code>memorizedState</code>实现了状态的管理和更新。Hooks提供了一种声明式的方式，让我们能够在函数组件中使用和更新状态，而<code>memorizedState</code>则是React内部用于存储和管理这些状态的数据结构。</p><p><strong>useState 和 memorizedState 状态举例</strong></p><p>当组件首次渲染时（mount阶段），React会创建一个新的Fiber节点，并在其中创建一个<code>memorizedState</code>来存储<code>useState</code> hook的初始值。这个<code>memorizedState</code>会被添加到Fiber节点的<code>memoizedState</code>属性中。</p><p>在更新阶段（update阶段），当组件重新渲染时，React会通过比较前后两次渲染中的<code>memorizedState</code>来判断状态是否发生了变化。</p><p>React会根据<code>useState</code> hook的调用顺序来确定<code>memorizedState</code>的位置。例如，在一个组件中多次调用了<code>useState</code> hook，React会按照调用的顺序在<code>memoizedState</code>属性中创建对应的<code>memorizedState</code>。</p><p>举一个例子，假设我们有一个表单组件，其中使用了两个<code>useState</code> hook来存储用户名和密码的值：</p><pre class="code-block"><code class="language-jsx">import React, { useState } from &#39;react&#39;;

function LoginForm() {
  const [username, setUsername] = useState(&#39;&#39;);
  const [password, setPassword] = useState(&#39;&#39;);

  return (
    &lt;form&gt;
      &lt;input
        type=&quot;text&quot;
        value={username}
        onChange={(e) =&gt; setUsername(e.target.value)}
      /&gt;
      &lt;input
        type=&quot;password&quot;
        value={password}
        onChange={(e) =&gt; setPassword(e.target.value)}
      /&gt;
      &lt;button type=&quot;submit&quot;&gt;Submit&lt;/button&gt;
    &lt;/form&gt;
  );
}
</code></pre><p>在这个例子中，我们在组件函数中分别调用了两次<code>useState</code> hook，创建了<code>username</code>和<code>password</code>这两个状态。</p><p>在首次渲染时（mount阶段），React会为每一个<code>useState</code> hook创建一个<code>memorizedState</code>对象，并将它们存储在组件的Fiber节点的<code>memoizedState</code>属性中。</p><p>当我们输入用户名或密码并触发onChange事件时，React会进入更新阶段（update阶段）。在这个阶段，React会比较前后两次渲染中的<code>memorizedState</code>，并根据变化的状态来更新UI。</p><p>React会比较<code>username</code>和<code>password</code>的旧值和新值，如果有变化，会更新对应的Fiber节点中的<code>memoizedState</code>，然后重新渲染组件，并将最新的<code>username</code>和<code>password</code>值传递给相应的input元素。</p><p>通过比较<code>memorizedState</code>，React能够检测到状态的变化，并只更新发生变化的部分，以提高性能和优化渲染过程。</p><h2>Comments / Answers</h2><hr /><p><strong>yanlele</strong> at 2023-08-02T15:50:45Z</p><p>其他参考文档：</p><p>https://github.com/Douc1998/React-Notes/issues/39</p></article>
  </main>
  <footer class="site-footer">© 面试题刷题 · 由本地静态页面生成</footer>
</body>
</html>