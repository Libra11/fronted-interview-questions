<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>[webpack] 手写一个 plugin, 统计源码里面的 console.log 调用数量与调用路径【热度: 113】 - 面试题刷题</title>
  <link rel="stylesheet" href="../assets/styles.css" />
  <meta name="description" content="&lt;p&gt;&lt;strong&gt;关键词&lt;/strong&gt;：手写 webpack plugin&lt;/p&gt;&lt;p&gt;创建一个 webpack 插件需要遵循 webpack 插件的基本结构和原则，同时为了实现统计源码里的 &lt;code&gt;console.log&lt;/code&gt; 调用数量与调用路径的目标，我们" />
  <link rel="icon" href="../assets/favicon.svg" />
  <style>.content a{color:var(--brand);} .content img{max-width:100%;}</style>
  
  <!-- Open Graph -->
  <meta property="og:title" content="[webpack] 手写一个 plugin, 统计源码里面的 console.log 调用数量与调用路径【热度: 113】" />
  <meta property="og:type" content="article" />
  <meta property="og:description" content="&lt;p&gt;&lt;strong&gt;关键词&lt;/strong&gt;：手写 webpack plugin&lt;/p&gt;&lt;p&gt;创建一个 webpack 插件需要遵循 webpack 插件的基本结构和原则，同时为了实现统计源码里的 &lt;code&gt;console.log&lt;/code&gt; 调用数量与调用路径的目标，我们可能需要对 webpack 的编译过程有一定的了解，尤其是如何操作 webpack 的模块系统内部的原始源代码。&lt;/p&gt;" />
  <meta property="og:locale" content="zh_CN" />
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <a class="logo" href="../index.html">面试题刷题</a>
      <nav class="nav">
        <a href="../index.html">首页</a>
        <a href="../index.html#categories">分类</a>
        <a href="https://github.com/pro-collection/interview-question/issues/837" target="_blank" rel="noopener">原始链接</a>
      </nav>
    </div>
  </header>
  <main class="container article">
    <div class="article-head">
      <a class="back" href="../index.html">← 返回列表</a>
      <h1>[webpack] 手写一个 plugin, 统计源码里面的 console.log 调用数量与调用路径【热度: 113】</h1>
      <div class="subtitle">工程化 · 工程化 · 美团</div>
      <div class="meta">创建：2024-08-18T06:28:25Z · 更新：2024-08-18T06:31:21Z</div>
    </div>
    <article class="content markdown-body"><p><strong>关键词</strong>：手写 webpack plugin</p><p>创建一个 webpack 插件需要遵循 webpack 插件的基本结构和原则，同时为了实现统计源码里的 <code>console.log</code> 调用数量与调用路径的目标，我们可能需要对 webpack 的编译过程有一定的了解，尤其是如何操作 webpack 的模块系统内部的原始源代码。</p><p>以下是创建这样一个插件的步骤与代码示例：</p><h3>步骤 1: 定义插件类</h3><p>首先，你需要定义一个 JavaScript 类。在类的 <code>apply</code> 方法中，你将会监听 webpack 的 <code>compilation</code> 钩子来访问并处理模块的源代码。</p><h3>步骤 2: 监听适当的 webpack 钩子</h3><p>针对源代码的处理，我们选择监听 <code>compilation</code> 阶段的 <code>optimizeModules</code> 钩子。在这个阶段，模块的原始源代码可以被访问和修改。</p><h3>步骤 3: 处理源代码</h3><p>处理每个模块的源代码，你可以使用简单的正则表达式或更高级的方法（如 AST 解析）来识别 <code>console.log</code> 的调用。在这个示例中，我将使用正则表达式来简化处理流程。</p><h3>代码示例</h3><p>下面是一个插件的基本实现：</p><pre class="code-block"><code class="language-javascript">class ConsoleLogStatsPlugin {
  apply(compiler) {
    compiler.hooks.compilation.tap(&quot;ConsoleLogStatsPlugin&quot;, (compilation) =&gt; {
      compilation.moduleTemplates.javascript.hooks.render.tap(&quot;ConsoleLogStatsPlugin&quot;, (moduleSource, module) =&gt; {
        // 计算当前模块的 console.log 调用并记录文件路径
        const source = moduleSource.source();
        const consoleLogMatches = source.match(/console\.log\(/g) || [];

        if (consoleLogMatches.length &gt; 0) {
          console.log(`模块 ${module.resource} 包含 ${consoleLogMatches.length} 次 console.log 调用。`);
        }

        return moduleSource;
      });
    });
  }
}

module.exports = ConsoleLogStatsPlugin;
</code></pre><h3>使用该插件</h3><p>要在你的 webpack 配置中使用这个插件，首先要导入它，然后将它的一个实例添加到配置的 <code>plugins</code> 数组中：</p><pre class="code-block"><code class="language-javascript">const ConsoleLogStatsPlugin = require(&quot;./path/to/ConsoleLogStatsPlugin&quot;);

module.exports = {
  // ...其他配置...
  plugins: [
    new ConsoleLogStatsPlugin(),
    // ...其他插件...
  ],
};
</code></pre><h3>注意事项</h3><ul><li><strong>性能考虑</strong>：直接操作源码可能对构建性能有一定影响。如果项目较大，可能需要考虑更高效的方式，例如仅在生产构建中运行该插件，或者使用更高效的代码分析方法。</li><li><strong>正则表达式的局限性</strong>：简单的正则表达式可能无法准确匹配所有 <code>console.log</code> 调用的场景，尤其是当代码中包含多行语句或复杂表达式时。更复杂的场景可能需要使用抽象语法树（AST）解析工具，如 Babel。</li><li><strong>webpack 版本兼容性</strong>：webpack 的插件 API 在不同的版本之间可能会有所变化。上述代码示例是基于假定的 API 结构编写的，实际使用时需要根据你的 webpack 版本调整 API 的使用。</li></ul><p>此插件可以视为检测源代码中 <code>console.log</code> 使用情况的起点，可以根据具体需求进行扩展和优化。</p></article>
  </main>
  <footer class="site-footer">© 面试题刷题 · 由本地静态页面生成</footer>
</body>
</html>