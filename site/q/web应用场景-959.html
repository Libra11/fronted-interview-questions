<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>分片上传文件，如何校验文件完整性【热度: 220】 - 面试题刷题</title>
  <link rel="stylesheet" href="../assets/styles.css" />
  <meta name="description" content="&lt;p&gt;分片上传是一种将大文件分割成多个小片段进行上传的方法，在分片上传过程中校验文件完整性非常重要，可以确保上传的文件在服务器端能够正确地组合成完整的文件。以下是一些校验文件完整性的思路：&lt;/p&gt;&lt;p&gt;&lt;strong&gt;一、使用哈希算法&lt;/strong&gt;&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;s" />
  <link rel="icon" href="../assets/favicon.svg" />
  <style>.content a{color:var(--brand);} .content img{max-width:100%;}</style>
  
  <!-- Open Graph -->
  <meta property="og:title" content="分片上传文件，如何校验文件完整性【热度: 220】" />
  <meta property="og:type" content="article" />
  <meta property="og:description" content="&lt;p&gt;分片上传是一种将大文件分割成多个小片段进行上传的方法，在分片上传过程中校验文件完整性非常重要，可以确保上传的文件在服务器端能够正确地组合成完整的文件。以下是一些校验文件完整性的思路：&lt;/p&gt;&lt;p&gt;&lt;strong&gt;一、使用哈希算法&lt;/strong&gt;&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;strong&gt;计算文件哈希值&lt;/strong&gt;：&lt;/li&gt;&lt;/ol&gt;&lt;ul&gt;&lt;li&gt;在客户端上传文件之前，先对整个文件计算" />
  <meta property="og:locale" content="zh_CN" />
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <a class="logo" href="../index.html">面试题刷题</a>
      <nav class="nav">
        <a href="../index.html">首页</a>
        <a href="../index.html#categories">分类</a>
        <a href="https://github.com/pro-collection/interview-question/issues/959" target="_blank" rel="noopener">原始链接</a>
      </nav>
    </div>
  </header>
  <main class="container article">
    <div class="article-head">
      <a class="back" href="../index.html">← 返回列表</a>
      <h1>分片上传文件，如何校验文件完整性【热度: 220】</h1>
      <div class="subtitle">web应用场景 · web应用场景</div>
      <div class="meta">创建：2024-10-07T07:54:11Z · 更新：2024-10-07T07:54:11Z</div>
    </div>
    <article class="content markdown-body"><p>分片上传是一种将大文件分割成多个小片段进行上传的方法，在分片上传过程中校验文件完整性非常重要，可以确保上传的文件在服务器端能够正确地组合成完整的文件。以下是一些校验文件完整性的思路：</p><p><strong>一、使用哈希算法</strong></p><ol><li><strong>计算文件哈希值</strong>：</li></ol><ul><li>在客户端上传文件之前，先对整个文件计算哈希值。常用的哈希算法有 MD5、SHA-1、SHA-256 等。</li><li>例如，使用 JavaScript 的<code>crypto-js</code>库计算文件的 MD5 哈希值：</li></ul><p>```javascript</p><p>import CryptoJS from "crypto-js";</p><p>const calculateFileHash = async (file) => {</p><p>const fileReader = new FileReader();</p><p>return new Promise((resolve, reject) => {</p><p>fileReader.onload = (event) => {</p><p>const hash = CryptoJS.MD5(event.target.result);</p><p>resolve(hash.toString());</p><p>};</p><p>fileReader.onerror = reject;</p><p>fileReader.readAsArrayBuffer(file);</p><p>});</p><p>};</p><p>```</p><ol><li><strong>上传过程中携带哈希值</strong>：</li></ol><ul><li>在进行分片上传时，将文件的哈希值作为一个参数一起上传给服务器。</li><li>可以在每个分片的请求中携带哈希值，或者在上传开始时先将哈希值发送给服务器。</li></ul><ol><li><strong>服务器端校验</strong>：</li></ol><ul><li>服务器在接收到所有分片并组合成完整文件后，再次计算文件的哈希值，并与客户端上传的哈希值进行比较。</li><li>如果两个哈希值一致，则说明文件完整无误；如果不一致，则说明文件在上传过程中可能出现了问题。</li></ul><p><strong>二、校验和（Checksum）</strong></p><ol><li><strong>计算校验和</strong>：</li></ol><ul><li>除了哈希算法，还可以使用校验和来校验文件完整性。校验和是通过对文件的每个字节进行特定的数学运算得到的一个值。</li><li>例如，可以使用简单的累加校验和算法，将文件的每个字节的值相加得到一个总和作为校验和。</li></ul><ol><li><strong>上传和校验</strong>：</li></ol><ul><li>在客户端计算文件的校验和，并在分片上传时将校验和发送给服务器。</li><li>服务器在组合完文件后，计算文件的校验和并与客户端上传的校验和进行比较，以确定文件的完整性。</li></ul><p><strong>三、文件大小比较</strong></p><ol><li><strong>记录文件大小</strong>：</li></ol><ul><li>在客户端上传文件之前，记录文件的大小。可以通过<code>File</code>对象的<code>size</code>属性获取文件的大小。</li></ul><ol><li><strong>服务器端验证</strong>：</li></ol><ul><li>服务器在接收到所有分片并组合成完整文件后，检查文件的大小是否与客户端上传的文件大小一致。</li><li>如果大小一致，则说明文件可能是完整的；如果不一致，则说明文件在上传过程中出现了问题。</li></ul><p><strong>四、上传状态跟踪</strong></p><ol><li><strong>客户端跟踪上传状态</strong>：</li></ol><ul><li>在客户端，可以使用一个数据结构来跟踪每个分片的上传状态，例如使用一个数组记录每个分片是否成功上传。</li><li>当所有分片都成功上传后，可以认为文件上传完整。</li></ul><ol><li><strong>服务器端确认</strong>：</li></ol><ul><li>服务器在接收到每个分片时，可以回复一个确认消息给客户端。客户端根据服务器的确认消息来更新上传状态。</li><li>当客户端收到服务器对所有分片的确认后，可以确定文件上传完整。</li></ul></article>
  </main>
  <footer class="site-footer">© 面试题刷题 · 由本地静态页面生成</footer>
</body>
</html>