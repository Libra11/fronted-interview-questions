<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>[React] forwardsRef 作用是啥， 有哪些使用场景？【热度: 336】 - 面试题刷题</title>
  <link rel="stylesheet" href="../assets/styles.css" />
  <meta name="description" content="&lt;p&gt;&lt;strong&gt;关键词&lt;/strong&gt;：forwardsRef 作用、forwardsRef 使用场景&lt;/p&gt;&lt;p&gt;在 React 中，&lt;code&gt;forwardRef&lt;/code&gt; 是一个用来传递 &lt;code&gt;ref&lt;/code&gt; 引用给子组件的技术。通常情况下，ref" />
  <link rel="icon" href="../assets/favicon.svg" />
  <style>.content a{color:var(--brand);} .content img{max-width:100%;}</style>
  
  <!-- Open Graph -->
  <meta property="og:title" content="[React] forwardsRef 作用是啥， 有哪些使用场景？【热度: 336】" />
  <meta property="og:type" content="article" />
  <meta property="og:description" content="&lt;p&gt;&lt;strong&gt;关键词&lt;/strong&gt;：forwardsRef 作用、forwardsRef 使用场景&lt;/p&gt;&lt;p&gt;在 React 中，&lt;code&gt;forwardRef&lt;/code&gt; 是一个用来传递 &lt;code&gt;ref&lt;/code&gt; 引用给子组件的技术。通常情况下，refs 是不会透传给子组件的，因为 refs 并不是像 &lt;code&gt;props&lt;/code&gt; 那样的属性。&lt;code&gt;for" />
  <meta property="og:locale" content="zh_CN" />
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <a class="logo" href="../index.html">面试题刷题</a>
      <nav class="nav">
        <a href="../index.html">首页</a>
        <a href="../index.html#categories">分类</a>
        <a href="https://github.com/pro-collection/interview-question/issues/741" target="_blank" rel="noopener">原始链接</a>
      </nav>
    </div>
  </header>
  <main class="container article">
    <div class="article-head">
      <a class="back" href="../index.html">← 返回列表</a>
      <h1>[React] forwardsRef 作用是啥， 有哪些使用场景？【热度: 336】</h1>
      <div class="subtitle">PDD · web框架 · PDD</div>
      <div class="meta">创建：2024-05-05T15:34:28Z · 更新：2024-12-21T08:34:55Z</div>
    </div>
    <article class="content markdown-body"><p><strong>关键词</strong>：forwardsRef 作用、forwardsRef 使用场景</p><p>在 React 中，<code>forwardRef</code> 是一个用来传递 <code>ref</code> 引用给子组件的技术。通常情况下，refs 是不会透传给子组件的，因为 refs 并不是像 <code>props</code> 那样的属性。<code>forwardRef</code> 提供了一种机制，可以将 <code>ref</code> 自动地通过组件传递到它的子组件。</p><h3><code>forwardRef</code> 的作用：</h3><ul><li><strong>访问子组件的 DOM 节点：</strong> 当需要直接访问子组件中的 DOM 元素（例如，需要管理焦点或测量尺寸）时，可以使用 <code>forwardRef</code>。</li><li><strong>在高阶组件（HOC）中转发 refs:</strong> 封装组件时，通过 <code>forwardRef</code> 可以将 ref 属性透传给被封装的组件，这样父组件就能够通过 ref 访问到实际的子组件实例或 DOM 节点。</li><li><strong>在函数组件中使用 refs(React 16.8+）：</strong> 在引入 Hook 之前，函数组件不能直接与 refs 交互。但是，引入了 <code>forwardRef</code> 和 <code>useRef</code> 之后，函数组件可以接受 ref 并将它透传给子节点。</li></ul><h3>使用场景举例：</h3><h4>1. 访问子组件的 DOM 节点</h4><p>假设你有一个 <code>FancyButton</code> 组件，你想从父组件中直接访问这个按钮的 DOM 节点。</p><pre class="code-block"><code class="language-jsx">const FancyButton = React.forwardRef((props, ref) =&gt; (
  &lt;button ref={ref} className=&quot;FancyButton&quot;&gt;
    {props.children}
  &lt;/button&gt;
));

// 现在你可以从父组件中直接获取DOM引用
const ref = React.createRef();
&lt;FancyButton ref={ref}&gt;Click me!&lt;/FancyButton&gt;;
</code></pre><h4>2. 在高阶组件中转发 refs</h4><p>一个常见的模式是为了抽象或修改子组件行为的高阶组件（HOC）。<code>forwardRef</code>可以用来确保 ref 可以传递给包装组件：</p><pre class="code-block"><code class="language-jsx">function logProps(Component) {
  class LogProps extends React.Component {
    componentDidUpdate(prevProps) {
      console.log(&quot;old props:&quot;, prevProps);
      console.log(&quot;new props:&quot;, this.props);
    }

    render() {
      const { forwardedRef, ...rest } = this.props;

      // 将自定义的 prop 属性 &quot;forwardedRef&quot; 定义为 ref
      return &lt;Component ref={forwardedRef} {...rest} /&gt;;
    }
  }

  // 注意：React.forwardRef 回调的第二个参数 &quot;ref&quot; 传递给了LogProps组件的props.forwardedRef
  return React.forwardRef((props, ref) =&gt; {
    return &lt;LogProps {...props} forwardedRef={ref} /&gt;;
  });
}
</code></pre><h4>3. 在函数组件中使用 ref</h4><p>在 Hook 出现之前，函数组件不能够直接与 <code>ref</code> 交云。现在可以这样做：</p><pre class="code-block"><code class="language-jsx">const MyFunctionalComponent = React.forwardRef((props, ref) =&gt; {
  return &lt;input type=&quot;text&quot; ref={ref} /&gt;;
});

const ref = React.createRef();
&lt;MyFunctionalComponent ref={ref} /&gt;;
</code></pre><p>当你需要在父组件中控制子组件中的 DOM 元素或组件实例的行为时，<code>forwardRef</code> 是非常有用的工具。不过，如果可行的话，通常最好通过状态提升或使用 context 来管理行为，只在没有其他替代的情况下才选择使用 refs。</p><h2>Comments / Answers</h2><hr /><p><strong>JTangming</strong> at 2024-05-10T10:09:19Z</p><p>顺便的，给一个 React.forwardRef 简单实现：</p><pre class="code-block"><code class="language-JS">import React from &#39;react&#39;;

// 简化的 React.forwardRef 实现
function forwardRef(renderFunction) {
  // 返回一个带有 forwardRef 属性的匿名函数组件
  return class ForwardedRef extends React.Component {
    render() {
      const { ref, ...rest } = this.props;
      // 调用传入的 renderFunction 渲染子组件，并将 ref 传递给子组件
      return renderFunction(rest, ref);
    }
  };
}

// 使用示例：一个简单的输入框组件
const InputComponent = forwardRef((props, ref) =&gt; (
  &lt;input type=&quot;text&quot; ref={ref} {...props} /&gt;
));

class App extends React.Component {
  constructor(props) {
    super(props);
    this.myRef = React.createRef();
  }

  componentDidMount() {
    this.myRef.current.focus();
  }

  render() {
    // 使用 forwardRef 创建的 InputComponent，可以直接访问到 input 元素的 ref
    return &lt;InputComponent ref={this.myRef} /&gt;;
  }
}

export default App;
</code></pre><hr /><p><strong>ifreeWorld</strong> at 2024-12-21T08:34:54Z</p><p>forwardRef会慢慢地被废弃掉，后面面试应该会比较少考这个题，除非面试官傻逼</p></article>
  </main>
  <footer class="site-footer">© 面试题刷题 · 由本地静态页面生成</footer>
</body>
</html>