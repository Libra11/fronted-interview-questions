<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>移动端如何实现下拉滚动加载（顶部加载）【热度: 740】 - 面试题刷题</title>
  <link rel="stylesheet" href="../assets/styles.css" />
  <meta name="description" content="&lt;p&gt;&lt;strong&gt;关键词&lt;/strong&gt;：移动端下拉加载&lt;/p&gt;&lt;blockquote&gt;有现成的文档可以直接参考， 讲得非常的全面&lt;/blockquote&gt;&lt;blockquote&gt;文章链接： https://juejin.cn/post/734083613620885917" />
  <link rel="icon" href="../assets/favicon.svg" />
  <style>.content a{color:var(--brand);} .content img{max-width:100%;}</style>
  
  <!-- Open Graph -->
  <meta property="og:title" content="移动端如何实现下拉滚动加载（顶部加载）【热度: 740】" />
  <meta property="og:type" content="article" />
  <meta property="og:description" content="&lt;p&gt;&lt;strong&gt;关键词&lt;/strong&gt;：移动端下拉加载&lt;/p&gt;&lt;blockquote&gt;有现成的文档可以直接参考， 讲得非常的全面&lt;/blockquote&gt;&lt;blockquote&gt;文章链接： https://juejin.cn/post/7340836136208859174&lt;/blockquote&gt;&lt;blockquote&gt;一下是作者对于改文章的总结&lt;/blockquote&gt;&lt;h3&gt;原理&lt;/" />
  <meta property="og:locale" content="zh_CN" />
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <a class="logo" href="../index.html">面试题刷题</a>
      <nav class="nav">
        <a href="../index.html">首页</a>
        <a href="../index.html#categories">分类</a>
        <a href="https://github.com/pro-collection/interview-question/issues/853" target="_blank" rel="noopener">原始链接</a>
      </nav>
    </div>
  </header>
  <main class="container article">
    <div class="article-head">
      <a class="back" href="../index.html">← 返回列表</a>
      <h1>移动端如何实现下拉滚动加载（顶部加载）【热度: 740】</h1>
      <div class="subtitle">web应用场景 · web应用场景</div>
      <div class="meta">创建：2024-08-25T06:54:00Z · 更新：2024-08-25T07:48:53Z</div>
    </div>
    <article class="content markdown-body"><p><strong>关键词</strong>：移动端下拉加载</p><blockquote>有现成的文档可以直接参考， 讲得非常的全面</blockquote><blockquote>文章链接： https://juejin.cn/post/7340836136208859174</blockquote><blockquote>一下是作者对于改文章的总结</blockquote><h3>原理</h3><p><img alt="prinple.png" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/506932c16c034452b90ae01decabf62c~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=825&amp;h=359&amp;s=455756&amp;e=png&amp;b=ffffff" /></p><p>如图所示，蓝色框代表视口，绿色框代表容器，橙色框代表加载动画。最开始时，加载动画处于视口外；开始下拉之后，容器向下移动，加载动画从上方进入视口；结束下拉后，容器又开始向上移动，加载动画也从上方退出视口。</p><h3>核心逻辑</h3><p>看完布局代码，我们再看逻辑代码。逻辑代码中，我们要监听用户的手指滑动、实现下拉手势。我们需要用到三个事件：</p><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element/touchstart_event" target="_blank" rel="noopener">touchstart</a> 代表触摸开始;</li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element/touchmove_event" target="_blank" rel="noopener">touchmove</a> 代表触摸移动;</li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element/touchend_event" target="_blank" rel="noopener">touchend</a> 代表触摸结束。</li></ul><p>从 <code>touchstart</code> 和 <code>touchmove</code> 事件中我们可以获取手指的坐标，比如 <code>event.touches[0].clientX</code> 是手指相对视口左边缘的 X 坐标，<code>event.touches[0].clientY</code> 是手指相对视口上边缘的 Y 坐标；从 <code>touchend</code> 事件中我们则无法获得 <code>clientX</code> 和 <code>clientY</code>。</p><p>我们可以先记录用户手指 touchstart 的 clientY 作为开始坐标，记录用户最后一次触发 touchmove 的 clientY 作为结束坐标，二者相减就得到手指移动的距离 distanceY。</p><p>设置手指移动多少距离，容器就移动多少距离，就得到了我们的逻辑代码：</p><pre class="code-block"><code class="language-js"> 代码解读const box = document.getElementById(&#39;box&#39;)
const loader = document.getElementById(&#39;loader&#39;)
let startY = 0, endY = 0, distanceY = 0

function start(e) {
  startY = e.touches[0].clientY
}

function move(e) {
  endY =  e.touches[0].clientY
  distanceY = endY - startY
  box.style = `
    transform: translateY(${distanceY}px);
    transition: all 0.3s linear;
  `
}

function end() {
  setTimeout(() =&gt; {
    box.style = `
      transform: translateY(0);
      transition: all 0.3s linear;
    `
    loader.className = &#39;loading&#39;
  }, 1000)
}

box.addEventListener(&#39;touchstart&#39;, start)
box.addEventListener(&#39;touchmove&#39;, move)
box.addEventListener(&#39;touchend&#39;, end)
</code></pre><p>逻辑代码实现一个简陋的下拉效果，当然现在还有很多缺陷。</p><p><img alt="pull-down-basic.gif" src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5fdc67efc50947e8bceb590b1e4d3df5~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=375&amp;h=400&amp;s=204176&amp;e=gif&amp;f=48&amp;b=efefef" /></p><h3>存在的 6 个个缺陷</h3><ul><li>没有最小、最大距离限制</li><li>加载动画没有停留在视口顶部</li><li>重复触发</li><li>没有限制方向</li><li>没有阻止原生滚动</li><li>没有阻止 iOS 橡皮筋效果</li></ul><h3>修复上面缺陷</h3><p>请看原文</p></article>
  </main>
  <footer class="site-footer">© 面试题刷题 · 由本地静态页面生成</footer>
</body>
</html>