<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>JS 严格模式为什么会禁用 with 语句？【热度: 210】 - 面试题刷题</title>
  <link rel="stylesheet" href="../assets/styles.css" />
  <meta name="description" content="&lt;blockquote&gt;作者备注： &lt;/blockquote&gt;&lt;blockquote&gt;实话实说， 这个问题真的很冷门。 如果有面试官问到这个问题了，感觉就是坏。 &lt;/blockquote&gt;&lt;blockquote&gt;但是作为一个知识点儿， 还是有一丢丢意思。 所以顺手就记录下来了。&lt;" />
  <link rel="icon" href="../assets/favicon.svg" />
  <style>.content a{color:var(--brand);} .content img{max-width:100%;}</style>
  
  <!-- Open Graph -->
  <meta property="og:title" content="JS 严格模式为什么会禁用 with 语句？【热度: 210】" />
  <meta property="og:type" content="article" />
  <meta property="og:description" content="&lt;blockquote&gt;作者备注： &lt;/blockquote&gt;&lt;blockquote&gt;实话实说， 这个问题真的很冷门。 如果有面试官问到这个问题了，感觉就是坏。 &lt;/blockquote&gt;&lt;blockquote&gt;但是作为一个知识点儿， 还是有一丢丢意思。 所以顺手就记录下来了。&lt;/blockquote&gt;&lt;p&gt;在 JavaScript 中，严格模式禁用了 with 语句，主要是出于以下三个原因：&lt;/" />
  <meta property="og:locale" content="zh_CN" />
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <a class="logo" href="../index.html">面试题刷题</a>
      <nav class="nav">
        <a href="../index.html">首页</a>
        <a href="../index.html#categories">分类</a>
        <a href="https://github.com/pro-collection/interview-question/issues/688" target="_blank" rel="noopener">原始链接</a>
      </nav>
    </div>
  </header>
  <main class="container article">
    <div class="article-head">
      <a class="back" href="../index.html">← 返回列表</a>
      <h1>JS 严格模式为什么会禁用 with 语句？【热度: 210】</h1>
      <div class="subtitle">JavaScript · JavaScript · TOP100互联网</div>
      <div class="meta">创建：2024-04-13T10:38:49Z · 更新：2024-04-13T10:38:50Z</div>
    </div>
    <article class="content markdown-body"><blockquote>作者备注：  </blockquote><blockquote>实话实说， 这个问题真的很冷门。 如果有面试官问到这个问题了，感觉就是坏。  </blockquote><blockquote>但是作为一个知识点儿， 还是有一丢丢意思。 所以顺手就记录下来了。</blockquote><p>在 JavaScript 中，严格模式禁用了 with 语句，主要是出于以下三个原因：</p><ol><li>性能问题：使用 with 语句会为 JavaScript 解释器带来优化难题。当使用 with 语句时，解释器在编译阶段无法确定对象属性的作用域，因此无法在编译时进行优化。这意味着在执行时需要做额外的作用域查找，可能会降低代码的执行效率。</li></ol><ol><li>代码可读性和维护性：with 语句可以将一个对象的所有属性和方法直接引入到当前作用域中，这可能会带来潜在的命名冲突。如果一个属性在 with 语句内部和外部作用域都有定义，编写和维护代码的人员可能会对此感到困惑。因此，这种语句的使用可以使代码的可读性和维护性降低。</li></ol><ol><li>编码错误可能性：with 语句改变了正常的作用域链查找规则，这可能会导致意外的变量分配。例如，如果 with 对象不包含某个属性，那么它可能意外地引用或创建一个全局变量，导致难以追踪的错误。</li></ol><p><strong>其中前两个原因还是比较好理解的，第三个原因， 「编码错误可能性」就需要好好解释下了：</strong></p><p>这里 with 语法， 我就不过多讲解了哈。 如果不知道语法的同学， 我这儿丢一个传送门：</p><p>下面的例子展示了<code>with</code>语句如何导致潜在的编码错误：</p><p>考虑下面的对象和<code>with</code>语句：</p><pre class="code-block"><code class="language-javascript">var person = {
  name: &quot;Alice&quot;,
  age: 25,
};

function updatePerson(person) {
  with (person) {
    name = &quot;Bob&quot;; // 意图是更新person的name属性
    age = 30; // 意图是更新person的age属性
  }
}

updatePerson(person);

console.log(person); // 输出: { name: &#39;Bob&#39;, age: 30 }，这里看起来没问题
</code></pre><p>看起来这段代码没有问题，并且确实更新了<code>person</code>对象；但问题出现在如果<code>with</code>中的属性并不存在于对象中：</p><pre class="code-block"><code class="language-javascript">var person = {
  name: &quot;Alice&quot;,
  age: 25,
};

function createNewPerson() {
  var name = &quot;Charlie&quot;;
  var age = 20;

  with (person) {
    name = &quot;David&quot;; // 本意是更新person的name属性
    age = 35; // 本意是更新person的age属性
    // 由于person没有phone属性，所以这将创建一个全局变量phone
    phone = &quot;123-456-7890&quot;;
  }

  // 调用者可能预期这里的name和age还是&#39;Charlie&#39;和20 - 因为 with 预期是更改 person 的属性；
  console.log(name, age); // 输出: &#39;David&#39; 35，而非&#39;Charlie&#39;, 20
}

createNewPerson();

console.log(window.phone); // 输出: &#39;123-456-7890&#39;
</code></pre><p>在这个例子里：</p><ul><li><code>name</code>和<code>age</code>都是局部变量，但它们被<code>with(person)</code>覆盖了，因为<code>person</code>对象确实有这样的属性。</li><li><code>phone</code>属性不在<code>person</code>对象中，<code>with</code>语句创建了一个全局变量<code>phone</code>。</li></ul><p>这展示了<code>with</code>语句如何引入两个潜在的陷阱：</p><ol><li><strong>局部变量被意外覆盖：</strong> 函数内部的<code>name</code>和<code>age</code>变量被覆盖，因为<code>with</code>语句使得<code>person</code>对象的属性在作用域链中的优先级高于局部变量。</li></ol><ol><li><strong>意外的全局变量：</strong> 因为<code>person</code>对象中没有<code>phone</code>属性，所以<code>phone</code>变成了一个全局变量。</li></ol><p>这些情况可能会导致难以追踪的错误和未预期的副作用，这正是为何严格模式中不允许使用<code>with</code>语句的原因之一。在严格模式中，代码会因试图使用<code>with</code>而抛出语法错误，上述的误导性行为就不会发生。</p></article>
  </main>
  <footer class="site-footer">© 面试题刷题 · 由本地静态页面生成</footer>
</body>
</html>